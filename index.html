<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.5">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;VA ECMO: Differential Hypoxia (Trainer V2.0)&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.jsdelivr.net/npm/chart.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Inter', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f4f4f5;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #1f2937;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>overscroll-behavior: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.content-wrapper { max-width: 1400px; margin: 0 auto; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.card {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #ffffff; border-radius: 16px;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0,0,0,0.05);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 20px; transition: all 0.3s ease-out;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.card:hover { box-shadow: 0 8px 20px rgba(0, 0, 0, 0.07), 0 4px 8px rgba(0,0,0,0.06); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.section-header {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex; justify-content: space-between; align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 16px; padding-bottom: 8px; border-bottom: 1px solid #e5e7eb;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.section-title { font-size: 1.125rem; font-weight: 600; color: #111827; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.section-title-collapsible { margin-bottom: 0 !important; border-bottom: none !important; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 10px 18px; border-radius: 8px; font-size: 0.875rem; font-weight: 500;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.2s ease-out; cursor: pointer; border: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: inline-flex; align-items: center; justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-primary { background-color: #007aff; color: white; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-primary:hover { background-color: #005ecb; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-secondary { background-color: #e5e7eb; color: #374151; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-secondary:hover { background-color: #d1d5db; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-event { background-color: #ff3b30; color: white; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-action { background-color: #34c759; color: white; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-action:hover { background-color: #2ca049; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-finish { background-color: #ff9500; color: white; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-finish:hover { background-color: #d97e00; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-debrief { background-color: #5856d6; color: white; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-debrief:hover { background-color: #4845b6; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn:disabled { opacity: 0.5; cursor: not-allowed; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.input-slider {</p>
<p class="p1"><span class="Apple-converted-space">            </span>-webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: #e5e7eb;</p>
<p class="p1"><span class="Apple-converted-space">            </span>outline: none; opacity: 1; transition: opacity .2s; border-radius: 3px; cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.input-slider::-webkit-slider-thumb {</p>
<p class="p1"><span class="Apple-converted-space">            </span>-webkit-appearance: none; appearance: none; width: 18px; height: 18px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: #007aff; border-radius: 50%; border: 3px solid white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 1px 3px rgba(0,0,0,0.1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.input-slider::-moz-range-thumb {</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 18px; height: 18px; background: #007aff; border-radius: 50%; border: 3px solid white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>select.custom-select, .trainer-input {</p>
<p class="p1"><span class="Apple-converted-space">            </span>appearance: none; -webkit-appearance: none; -moz-appearance: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236b7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.25em;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding-right: 2.5rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.trainer-input { /* For number inputs in trainer section */</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-image: none; /* Remove dropdown arrow */</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding-right: 0.75rem;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease-out, visibility 0s 0.3s linear; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.modal.active { opacity: 1; visibility: visible; transition: opacity 0.3s ease-out, transform 0.3s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.modal-content { background-color: white; padding: 24px; border-radius: 16px; width: 90%; max-width: 680px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); transform: scale(0.95); transition: transform 0.3s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.modal.active .modal-content { transform: scale(1); }</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.log-message { border-bottom: 1px solid #f3f4f6; padding: 6px 2px; font-size: 0.8rem; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.log-message:last-child { border-bottom: none; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.log-message.narrative { font-style: italic; color: #581c87; background-color: #f3e8ff; padding: 6px; border-radius: 6px; margin-bottom:3px;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.log-message.event { font-weight: 500; color: #5856d6; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.log-message.warning { color: #ff9500; font-weight: 500;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.log-message.critical { color: #ff3b30; font-weight: 600; background-color: #ffe5e5; padding: 6px; border-radius: 6px;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.log-message.success { color: #34c759; background-color: #e6f7ea; font-weight: 500; padding: 6px; border-radius: 6px;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.log-message.intervention { color: #007aff; background-color: #e5f2ff; padding: 6px; border-radius: 6px;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.log-message.trainer { font-weight: 500; color: #4a00e0; background-color: #eadaff; padding: 6px; border-radius: 6px; margin-bottom:3px;} /* Trainer log style */</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.history-panel { background-color: #eef2ff; border-left: 4px solid #4f46e5; padding: 12px; margin-bottom: 16px; border-radius: 8px;}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>#vitalsMonitor {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #1a202c; color: #e2e8f0; padding: 16px; border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: grid; grid-template-columns: 1fr 250px; gap: 12px; margin-bottom: 20px; border: 1px solid #2d3748;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.waveforms-column { display: flex; flex-direction: column; gap: 8px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.waveform-container { background-color: #0d1117; border-radius: 8px; padding: 8px; height: 100px; position: relative; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.waveform-container canvas { width: 100%; height: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.waveform-label { position: absolute; top: 4px; left: 8px; font-size: 0.75rem; font-weight: 500; text-transform: uppercase; }</p>
<p class="p1"><span class="Apple-converted-space">         </span>#ecgLabel { color: #30d158; } #spo2PlethLabel { color: #0a84ff; } #artLabel { color: #ff453a; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.numerics-column { display: flex; flex-direction: column; justify-content: space-around; background-color: #2d3748; border-radius: 8px; padding: 12px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.vital-display { text-align: right; padding: 4px 0; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.vital-display .label { font-size: 0.8rem; text-transform: uppercase; color: #a0aec0; margin-bottom: 0; display: inline-block; width: 60px; text-align: left; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.vital-display .value { font-size: 1.75rem; font-weight: 600; line-height: 1.1; display: inline-block; margin-left: 8px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.vital-display .unit { font-size: 0.7rem; color: #a0aec0; margin-left: 4px; display: inline-block; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#hrDisplayValue { color: #30d158; } #bpDisplayValue, #meanBpDisplayValue { color: #ff453a; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>#spo2DisplayValue { color: #0a84ff; } #spo2RarmDisplayValue.low-sat { color: #ff9f0a !important; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>#tempDisplayValue { color: #ff9f0a; } #cvpDisplayValue { color: #bf5af2; } #papDisplayValue { color: #f59e0b;}<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.dial-container { display: flex; flex-direction: column; align-items: center; margin-bottom: 12px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dial { width: 72px; height: 72px; border-radius: 50%; background-color: #f3f4f6; position: relative; display: flex; justify-content: center; align-items: center; border: 1px solid #e5e7eb; box-shadow: inset 0 2px 4px rgba(0,0,0,0.03); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dial-needle { width: 2px; height: 30px; background-color: #007aff; position: absolute; bottom: 50%; left: calc(50% - 1px); transform-origin: bottom center; transition: transform 0.3s cubic-bezier(0.25, 0.1, 0.25, 1); border-radius: 1px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dial-center-dot { width: 8px; height: 8px; background-color: #007aff; border-radius: 50%; z-index: 1;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dial-value-display { font-size: 0.875rem; font-weight: 600; color: #111827; margin-top: 6px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dial-label { font-size: 0.75rem; color: #4b5563; margin-bottom: 4px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dial-controls { display: flex; justify-content: center; align-items: center; margin-top: 8px;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dial-btn { background-color: #e5e7eb; color: #374151; border: none; width: 28px; height: 28px; border-radius: 50%; margin: 0 6px; font-size: 1.1rem; line-height: 1; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: background-color 0.2s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.dial-btn:hover { background-color: #d1d5db; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#actualEcmoFlowDisplayContainer { background-color: #f9fafb; padding: 8px 12px; border-radius: 8px; margin-top: 10px; text-align: center; border: 1px solid #e5e7eb; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#actualEcmoFlowDisplayContainer .label { font-size: 0.8rem; color: #4b5563; display: block; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#actualEcmoFlowDisplayContainer .value { font-size: 1.375rem; font-weight: 600; color: #007aff; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>#ventilatorWaveformContainer { background-color: #f9fafb; border: 1px solid #e5e7eb; padding: 12px; border-radius: 12px; margin-top: 12px; height: 160px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.vent-param-label { color: #374151; font-weight: 500; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.vent-param-value-display { color: #007aff; font-weight: 600;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.vent-param-unit { color: #6b7280; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#ventilatorSettingsContent, #trainerControlsContent { max-height: 0; overflow: hidden; transition: max-height 0.5s cubic-bezier(0.25, 0.1, 0.25, 1), padding 0.5s cubic-bezier(0.25, 0.1, 0.25, 1); padding-top: 0; padding-bottom: 0; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#ventilatorSettingsContent.expanded, #trainerControlsContent.expanded { max-height: 1000px; padding-top: 8px; padding-bottom: 8px; }</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.cannula-box { width: 160px; height: 120px; border: 1px solid #d1d5db; display: flex; justify-content: space-around; align-items: center; padding: 0px 8px 0px 8px; margin: 12px auto; background-color: #f9fafb; border-radius: 12px; overflow: hidden; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.cannula { width: 20px; height: 90%; border: 1px solid #4b5563; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: white; text-shadow: 1px 1px 1px rgba(0,0,0,0.3); box-shadow: inset 0 0 3px rgba(0,0,0,0.2); transition: background-color 0.5s ease-out; flex-direction: column; text-align: center; padding: 2px;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>#accessCannula { background-color: #059669; } #returnCannula { background-color: #dc2626; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.cannula-label { font-size: 0.55rem; margin-top: 2px; }</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>#ecmoPressureConsole { background-color: #f9fafb; border-radius: 12px; padding: 10px 16px; margin-top: 12px; display: flex; justify-content: space-around; align-items: center; border: 1px solid #e5e7eb; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.pressure-item { text-align: center; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.pressure-label { font-size: 0.75rem; color: #6b7280; display: block; margin-bottom: 0px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.pressure-value { font-size: 1.5rem; font-weight: 600; line-height: 1.1; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.pressure-unit { font-size: 0.7rem; color: #6b7280; display: block; margin-top: -2px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#p1DisplayValue { color: #ef4444; } #p2DisplayValue { color: #f59e0b; } #p3DisplayValue { color: #22c55e; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.custom-dropdown-container { position: relative; width: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.custom-dropdown-button { background-color: white; border: 1px solid #d1d5db; border-radius: 8px; padding: 10px 12px; font-size: 0.875rem; width: 100%; text-align: left; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.custom-dropdown-button:hover { border-color: #a0aec0; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.custom-dropdown-button:focus, .custom-dropdown-button.open { outline: none; border-color: #007aff; box-shadow: 0 0 0 2px rgba(0, 122, 255, 0.2); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.custom-dropdown-options { position: absolute; background-color: white; border: 1px solid #d1d5db; border-radius: 8px; width: 100%; max-height: 200px; overflow-y: auto; z-index: 20; box-shadow: 0 8px 16px rgba(0,0,0,0.1); opacity: 0; visibility: hidden; transform: translateY(5px); transition: opacity 0.2s ease-out, transform 0.2s ease-out, visibility 0s 0.2s linear; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.custom-dropdown-options.open { opacity: 1; visibility: visible; transform: translateY(0); transition: opacity 0.2s ease-out, transform 0.2s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.custom-dropdown-options a { display: block; padding: 10px 12px; font-size: 0.875rem; color: #374151; text-decoration: none; cursor: pointer; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.custom-dropdown-options a:hover { background-color: #f4f4f5; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.arrow-icon { transition: transform 0.3s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.arrow-icon.rotated { transform: rotate(180deg); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.hidden { display: none !important; }<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.text-label { font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 4px; display: block; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.text-value { font-size: 0.875rem; color: #1f2937; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.text-xs { font-size: 0.8rem; }<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.debrief-column .list-disc { max-height: 300px; overflow-y: auto; padding-right: 8px; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.debrief-column h5 { margin-bottom: 8px; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.debrief-column .ideal-step { margin-bottom: 4px; }</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>.action-taken-good { color: #16a34a; } /* Green */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.action-taken-missed { color: #dc2626; } /* Red */</p>
<p class="p1"><span class="Apple-converted-space">        </span>.action-taken-consider { color: #f59e0b; } /* Amber */</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.trainer-control-item { margin-bottom: 12px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.trainer-control-item label { display: block; font-size: 0.8rem; color: #4b5563; margin-bottom: 4px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.trainer-control-item .value-display { font-weight: 600; color: #007aff; margin-left: 6px;}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.trainer-control-item input[type="checkbox"] { width: 1rem; height: 1rem; margin-right: 6px; accent-color: #007aff; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="p-4 md:p-6 space-y-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="content-wrapper"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="history-panel"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-md font-semibold text-indigo-700 mb-1"&gt;Patient History&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="text-xs text-gray-700" id="patientHistoryDisplay"&gt;Loading history...&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="vitalsMonitor"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="waveforms-column"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="waveform-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="ecgLabel" class="waveform-label"&gt;ECG II&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;canvas id="ecgWaveformChart"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="waveform-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span id="artLabel" class="waveform-label"&gt;ART&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;canvas id="arterialLineChart"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="waveform-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;span id="spo2PlethLabel" class="waveform-label"&gt;Pleth&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;canvas id="spo2PlethWaveformChart"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="numerics-column"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="vital-display"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="label"&gt;HR&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="value" id="hrDisplayValue"&gt;105&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="unit"&gt;bpm&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="vital-display"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="label"&gt;ART&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="value" id="bpDisplayValue"&gt;95/60&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="unit"&gt;mmHg&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="vital-display"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="label"&gt;Mean&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="value" id="meanBpDisplayValue"&gt;72&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="unit"&gt;mmHg&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="vital-display"&gt; &lt;span class="label"&gt;SpO2&lt;/span&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="value" id="spo2DisplayValue"&gt;99&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="unit"&gt;%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="vital-display"&gt; &lt;span class="label"&gt;SpO2 RA&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="value" id="spo2RarmDisplayValue"&gt;88&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="unit"&gt;%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="vital-display"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="label"&gt;CVP&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="value" id="cvpDisplayValue"&gt;10&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="unit"&gt;mmHg&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="vital-display"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="label"&gt;PA Dias&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="value" id="papDisplayValue"&gt;28&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="unit"&gt;mmHg&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="vital-display"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="label"&gt;Temp&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="value" id="tempDisplayValue"&gt;36.8&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;span class="unit"&gt;&amp;deg;C&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="grid grid-cols-1 lg:grid-cols-3 gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="space-y-6"&gt; &lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="section-header"&gt; &lt;h2 class="section-title"&gt;Patient Information&lt;/h2&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="space-y-2 text-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;&lt;strong class="font-medium text-gray-600"&gt;ID:&lt;/strong&gt; &lt;span class="text-gray-800"&gt;ECMO-DH-SIM-002&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;&lt;strong class="font-medium text-gray-600"&gt;Age:&lt;/strong&gt; &lt;span class="text-gray-800"&gt;62M&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;&lt;strong class="font-medium text-gray-600"&gt;Weight:&lt;/strong&gt; &lt;span class="text-gray-800" id="patientWeightDisplay"&gt;80 kg&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;&lt;strong class="font-medium text-gray-600"&gt;Condition:&lt;/strong&gt; &lt;span class="text-gray-800" id="patientConditionDisplay"&gt;Post-Valve Surgery, LV Recovery, Severe ARDS&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;&lt;strong class="font-medium text-gray-600"&gt;Cannulae:&lt;/strong&gt; &lt;span class="text-gray-800" id="patientCannulaeDisplay"&gt;Fem-Fem (Access 25Fr Venous, Return 19Fr Arterial)&lt;/span&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;p&gt;&lt;strong class="font-medium text-gray-600"&gt;Scenario Time:&lt;/strong&gt; &lt;span id="scenarioTimeDisplay" class="text-gray-800"&gt;0&lt;/span&gt; mins&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;div class="section-header"&gt; &lt;h2 class="section-title"&gt;ECMO Cannula Status&lt;/h2&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="cannula-box"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="accessCannula" class="cannula"&gt;Access &lt;span class="cannula-label"&gt;(Venous)&lt;/span&gt;&lt;/div&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="returnCannula" class="cannula"&gt;Return &lt;span class="cannula-label"&gt;(Arterial)&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="ecmoPressureConsole"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="pressure-item"&gt; &lt;span class="pressure-label"&gt;P1 (Access)&lt;/span&gt; &lt;span id="p1DisplayValue" class="pressure-value"&gt;-30&lt;/span&gt; &lt;span class="pressure-unit"&gt;mmHg&lt;/span&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="pressure-item"&gt; &lt;span class="pressure-label"&gt;P2 (Pre-Oxy)&lt;/span&gt; &lt;span id="p2DisplayValue" class="pressure-value"&gt;280&lt;/span&gt; &lt;span class="pressure-unit"&gt;mmHg&lt;/span&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="pressure-item"&gt; &lt;span class="pressure-label"&gt;P3 (Post-Oxy)&lt;/span&gt; &lt;span id="p3DisplayValue" class="pressure-value"&gt;250&lt;/span&gt; &lt;span class="pressure-unit"&gt;mmHg&lt;/span&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="space-y-6"&gt; &lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="section-header"&gt; &lt;h2 class="section-title"&gt;ECMO Settings&lt;/h2&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="grid grid-cols-3 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="dial-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="dial-label"&gt;RPM&lt;/label&gt; &lt;div class="dial" id="rpmDial"&gt; &lt;div class="dial-needle" id="rpmNeedle"&gt;&lt;/div&gt; &lt;div class="dial-center-dot"&gt;&lt;/div&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="dial-value-display" id="ecmoRpmValueDisplay"&gt;3000&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="dial-controls"&gt; &lt;button class="dial-btn" data-control="rpm" data-action="decrease"&gt;-&lt;/button&gt; &lt;button class="dial-btn" data-control="rpm" data-action="increase"&gt;+&lt;/button&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="dial-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="dial-label"&gt;Sweep (L/min)&lt;/label&gt; &lt;div class="dial" id="sweepDial"&gt; &lt;div class="dial-needle" id="sweepNeedle"&gt;&lt;/div&gt; &lt;div class="dial-center-dot"&gt;&lt;/div&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="dial-value-display" id="ecmoSweepValueDisplay"&gt;5.0&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="dial-controls"&gt; &lt;button class="dial-btn" data-control="sweep" data-action="decrease"&gt;-&lt;/button&gt; &lt;button class="dial-btn" data-control="sweep" data-action="increase"&gt;+&lt;/button&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="dial-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label class="dial-label"&gt;FiO2 (%)&lt;/label&gt; &lt;div class="dial" id="fio2Dial"&gt; &lt;div class="dial-needle" id="fio2Needle"&gt;&lt;/div&gt; &lt;div class="dial-center-dot"&gt;&lt;/div&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="dial-value-display" id="ecmoFio2ValueDisplay"&gt;100&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="dial-controls"&gt; &lt;button class="dial-btn" data-control="fio2" data-action="decrease"&gt;-&lt;/button&gt; &lt;button class="dial-btn" data-control="fio2" data-action="increase"&gt;+&lt;/button&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="actualEcmoFlowDisplayContainer"&gt; &lt;span class="label"&gt;Actual ECMO Flow&lt;/span&gt; &lt;span class="value" id="actualEcmoFlowDisplay"&gt;4.0 L/min&lt;/span&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="section-header cursor-pointer" id="ventilatorSettingsHeader" role="button" aria-expanded="false" aria-controls="ventilatorSettingsContent"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h2 class="section-title section-title-collapsible"&gt;Ventilator Settings (Lung Protective)&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span id="ventilatorToggleIcon" class="text-gray-500 fas fa-chevron-down transition-transform duration-300 arrow-icon"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="ventilatorSettingsContent" class=""&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="mb-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label for="ventModeSelector" class="text-label"&gt;Mode:&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;select id="ventModeSelector" class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500 bg-gray-50 custom-select"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="PCV_AC"&gt;PCV A/C&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="APRV"&gt;APRV&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;option value="PRVC"&gt;PRVC&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="ventilatorParamsContainer" class="space-y-2.5 mt-3 p-3 bg-slate-50 rounded-lg"&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="ventilatorWaveformContainer"&gt; &lt;canvas id="ventilatorWaveformChart"&gt;&lt;/canvas&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="space-y-6"&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;div class="card"&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="section-header"&gt; &lt;h2 class="section-title"&gt;Diagnostics&lt;/h2&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="custom-dropdown-container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button id="diagnosticDropdownButton" class="custom-dropdown-button"&gt; &lt;span id="diagnosticSelectedText"&gt;Select Diagnostic...&lt;/span&gt; &lt;span class="fas fa-chevron-down arrow-icon text-gray-500"&gt;&lt;/span&gt; &lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="diagnosticOptions" class="custom-dropdown-options"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="abg_paired_radial_femoral"&gt;Paired ABG (R.Radial &amp; Femoral/ECMO)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="echo_cardiac_lv_recovery"&gt;Focused ECHO (LV Function, AoV Opening, Shunt)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="cxr_ards"&gt;CXR (ARDS Assessment)&lt;/a&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="prePostGases_ecmo"&gt;Pre/Post Membrane Gases (ECMO Circuit)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="lactate_serial"&gt;Lactate (Serial)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="ecg_12lead_general"&gt;12-Lead ECG (General Assessment)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="electrolytes_full"&gt;Full Electrolyte Panel (K,Mg,Ca,Phos)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="cbc_coags_full"&gt;CBC &amp; Full Coagulation Profile&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="hidden" id="diagnosticSelectedValue" value=""&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="card"&gt;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="section-header"&gt; &lt;h2 class="section-title"&gt;Interventions&lt;/h2&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="custom-dropdown-container mb-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;button id="interventionDropdownButton" class="custom-dropdown-button"&gt; &lt;span id="interventionSelectedText"&gt;Select Action/Procedure...&lt;/span&gt; &lt;span class="fas fa-chevron-down arrow-icon text-gray-500"&gt;&lt;/span&gt; &lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div id="interventionOptions" class="custom-dropdown-options"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="increase_vent_fio2"&gt;Increase Ventilator FiO2 (e.g., to 100%)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="increase_vent_peep"&gt;Increase Ventilator PEEP (cautiously)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="optimize_vent_strategy"&gt;Optimize Ventilator Strategy (e.g., APRV, recruitment)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;hr class="my-1 border-gray-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="increase_ecmo_flow"&gt;Increase ECMO Flow (RPM up)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="decrease_ecmo_flow"&gt;Decrease ECMO Flow (RPM down - cautiously if LV good)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                             </span>&lt;hr class="my-1 border-gray-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="admin_vasodilator_pulm"&gt;Administer Inhaled Pulmonary Vasodilator (e.g., iNO)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="admin_beta_blocker_careful"&gt;Administer Beta-Blocker (small dose, very cautiously)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="fluid_challenge_careful"&gt;Fluid Challenge (if CVP low and suspect hypovolemia)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                             </span>&lt;hr class="my-1 border-gray-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="consult_cardiac_surgery_ecmo"&gt;Consult Cardiac Surgery / ECMO Specialist (Re-cannulation?)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;a href="#" role="option" data-value="initiate_vav_ecmo" class="font-semibold text-indigo-600"&gt;Initiate VAV ECMO (Resolve Differential Hypoxia)&lt;/a&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="hidden" id="interventionSelectedValue" value=""&gt;</p>
<p class="p1"><span class="Apple-converted-space">                 </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- Trainer Controls Card --&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="section-header cursor-pointer" id="trainerControlsHeader" role="button" aria-expanded="false" aria-controls="trainerControlsContent"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;h2 class="section-title section-title-collapsible"&gt;Trainer Controls&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span id="trainerControlsToggleIcon" class="text-gray-500 fas fa-chevron-down transition-transform duration-300 arrow-icon"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div id="trainerControlsContent" class="space-y-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="trainer-control-item"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label for="trainerLungCapacitySlider"&gt;Native Lung Oxygenation Capacity: &lt;span id="trainerLungCapacityValue" class="value-display"&gt;0.20&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="range" id="trainerLungCapacitySlider" min="0.00" max="1.00" step="0.01" class="input-slider"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="trainer-control-item"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label for="trainerLvefSlider"&gt;Native LVEF: &lt;span id="trainerLvefValue" class="value-display"&gt;0.40&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="range" id="trainerLvefSlider" min="0.10" max="0.70" step="0.01" class="input-slider"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="trainer-control-item"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label for="trainerAovFactorSlider"&gt;Aortic Valve Opening Factor: &lt;span id="trainerAovFactorValue" class="value-display"&gt;0.9&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="range" id="trainerAovFactorSlider" min="0.1" max="1.0" step="0.01" class="input-slider"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                         </span>&lt;div class="trainer-control-item"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label for="trainerCvpInput"&gt;Override CVP (mmHg): &lt;span id="trainerCvpValue" class="value-display"&gt;10&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="number" id="trainerCvpInput" min="0" max="30" step="1" class="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500 bg-white trainer-input"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="trainer-control-item"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label for="trainerLactateInput"&gt;Override Lactate (mmol/L): &lt;span id="trainerLactateValue" class="value-display"&gt;1.8&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="number" id="trainerLactateInput" min="0.5" max="20" step="0.1" class="w-full p-1.5 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500 bg-white trainer-input"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="trainer-control-item flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="checkbox" id="trainerInhaledNoToggle"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label for="trainerInhaledNoToggle" class="ml-2 text-sm"&gt;Inhaled NO Active&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="trainer-control-item flex items-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;input type="checkbox" id="trainerVavEcmoToggle"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;label for="trainerVavEcmoToggle" class="ml-2 text-sm"&gt;VAV ECMO Active&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;!-- End Trainer Controls Card --&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="card"&gt; &lt;div class="section-header"&gt; &lt;h2 class="section-title"&gt;Scenario Control&lt;/h2&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="space-y-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button id="nextEventButton" class="w-full btn btn-event"&gt;Next Scenario Event&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button id="finishScenarioButton" class="w-full btn btn-finish"&gt;Finish Scenario&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div id="postScenarioOptions" class="mt-3 space-y-2 hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;button id="debriefingButton" class="w-full btn btn-debrief"&gt;Scenario Debriefing&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="section-header"&gt; &lt;h2 class="section-title"&gt;Medications (General Support)&lt;/h2&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="space-y-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="sedationSlider" class="text-label"&gt;Sedation (Propofol mcg/kg/min): &lt;span id="sedationValue" class="font-semibold text-blue-600"&gt;15&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="range" id="sedationSlider" min="0" max="80" step="5" value="15" class="input-slider"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="paralyticSlider" class="text-label"&gt;Paralytic (Cisatracurium mcg/kg/min): &lt;span id="paralyticValue" class="font-semibold text-blue-600"&gt;0.3&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="range" id="paralyticSlider" min="0" max="5" step="0.1" value="0.3" class="input-slider"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                     </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;label for="inotropeSlider" class="text-label"&gt;Inotrope (Dobutamine mcg/kg/min): &lt;span id="inotropeValue" class="font-semibold text-purple-600"&gt;2&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="range" id="inotropeSlider" min="0" max="20" step="1" value="2" class="input-slider"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="mt-6 card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">             </span>&lt;div class="section-header"&gt; &lt;h2 class="section-title"&gt;Scenario Log &amp; Messages&lt;/h2&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="scenarioLog" class="h-48 overflow-y-auto text-sm space-y-1 pr-2"&gt; &lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="infoModal" class="modal"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="modal-content"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h3 id="modalTitle" class="text-xl font-semibold mb-3 text-gray-800"&gt;&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="modalBody" class="text-sm text-gray-700 whitespace-pre-wrap max-h-[70vh] overflow-y-auto"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="closeModalButton" class="mt-5 btn btn-primary w-full"&gt;Close&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>// --- PATIENT DATA &amp; SIMULATION LOGIC (VA ECMO - Trainer V2.0) ---</p>
<p class="p1"><span class="Apple-converted-space">    </span>let patientData_DH = {</p>
<p class="p1"><span class="Apple-converted-space">        </span>scenarioTime: 0, hr: 105, systolicBP: 95, diastolicBP: 60, <span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>get meanBP() { return this.diastolicBP + Math.floor((this.systolicBP - this.diastolicBP) / 3); },</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>spO2_femoral: 99,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>spO2_r_arm: 82,<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>temp: 36.8, cvp: 10, paDiastolic: 28,<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ph_systemic: 7.35, pco2_systemic: 40, po2_systemic: 95, hco3_systemic: 22, be_systemic: -2,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>lactate: 1.8,<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ph_r_radial: 7.28, pco2_r_radial: 50, po2_r_radial: 50, hco3_r_radial: 19,<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>potassium: 4.0, magnesium: 2.0, calcium: 8.9, sodium: 140, phosphate: 3.0,</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ecmoRpm: 3000,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>currentEcmoFlow: 0,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ecmoSweep: 5.0, ecmoFiO2: 100,</p>
<p class="p1"><span class="Apple-converted-space">        </span>p1: -30, p2: 280, p3: 250,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>preMembranePaO2: 45, preMembranePaCO2: 48,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>postMembranePaO2: 500, postMembranePaCO2: 30,</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ventMode: "PCV_AC", ventFiO2: 60,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ventPIP_PCVAC: 28, ventPEEP_PCVAC: 12, ventRR_PCVAC: 14,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ventPHigh_APRV: 28, ventPLow_APRV: 8, ventTHigh_APRV: 1.5, ventTLow_APRV: 0.6,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ventTargetVt_PRVC: 400, ventMaxP_PRVC: 30, ventPEEP_PRVC: 12, ventRR_PRVC: 14,</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>cbcHb: 9.5, cbcPlt: 180, coagINR: 1.2, coagAPTT: 40,</p>
<p class="p1"><span class="Apple-converted-space">        </span>sedationLevel: 15, paralyticLevel: 0.3, inotropeLevel: 2,<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>nativeLVEF: 0.40,<span class="Apple-converted-space">                       </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>aorticValveOpeningFactor: 0.9, <span class="Apple-converted-space">         </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>nativeLungOxygenationCapacity: 0.20,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>initialNativeLungOxygenationCapacity: 0.20,</p>
<p class="p1"><span class="Apple-converted-space">        </span>paO2_native_lungs_floor: 25,<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>differentialHypoxiaActive: true,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>inhaledNOPulmonaryVasodilatorActive: false,</p>
<p class="p1"><span class="Apple-converted-space">        </span>awaitingVentOptimization: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>vavEcmoActive: false,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>actionsTaken: [], weightKg: 80,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>accessCannulaSize: "25Fr Venous", returnCannulaSize: "19Fr Arterial",</p>
<p class="p1"><span class="Apple-converted-space">        </span>scenarioEventTriggers: 0,</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const scenarioLogEl_DH = document.getElementById('scenarioLog');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const simulationInterval_DH = 5000;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>const fastUpdateInterval_DH = 150;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>let simIntervalId_DH, fastUpdateIntervalId_DH;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let ventilatorWaveformChart_DH, arterialLineChart_DH, ecgWaveformChart_DH, spo2PlethWaveformChart_DH;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>let artLineWaveformPhase_DH = 0;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>let ecgWaveformPhase_DH = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let spo2PlethWaveformPhase_DH = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const WAVEFORM_POINTS_DISPLAYED_DH = 250;<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Function to log actions or messages to the scenario log</p>
<p class="p1"><span class="Apple-converted-space">    </span>function logAction_DH(actionDescription, type = 'intervention') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const time = patientData_DH.scenarioTime.toFixed(1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.actionsTaken.push({ time: time, action: actionDescription, type: type });</p>
<p class="p1"><span class="Apple-converted-space">        </span>logMessage_DH(actionDescription, type);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>function logMessage_DH(message, type = 'info') {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const p = document.createElement('p');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const minutes = Math.floor(patientData_DH.scenarioTime);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const seconds = Math.round((patientData_DH.scenarioTime - minutes) * 60);</p>
<p class="p1"><span class="Apple-converted-space">        </span>p.innerHTML = `&lt;span class="font-medium text-gray-500"&gt;[${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}]&lt;/span&gt; ${message}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>p.className = 'log-message'; if (type) p.classList.add(type);</p>
<p class="p1"><span class="Apple-converted-space">        </span>scenarioLogEl_DH.appendChild(p); scenarioLogEl_DH.scrollTop = scenarioLogEl_DH.scrollHeight;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Displays the initial patient history and logs the start of the scenario</p>
<p class="p1"><span class="Apple-converted-space">    </span>function displayInitialHistory_DH() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const history = `A 62-year-old male (${patientData_DH.weightKg} kg) s/p aortic valve replacement, complicated by severe post-operative LV dysfunction requiring VA ECMO (Fem-Fem: Access ${patientData_DH.accessCannulaSize}, Return ${patientData_DH.returnCannulaSize}). Over the past 24 hours, LV function shows significant recovery (LVEF ~${(patientData_DH.nativeLVEF*100).toFixed(0)}%, Aortic Valve Opening Factor ~${patientData_DH.aorticValveOpeningFactor.toFixed(1)}). However, patient has developed severe ARDS with worsening native lung gas exchange (current capacity factor: ${patientData_DH.nativeLungOxygenationCapacity.toFixed(2)}). Concerns for differential hypoxia are high, with initial R.Arm SpO2 noted to be significantly lower than femoral. Baseline ECMO flow ~4.0 L/min.`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('patientHistoryDisplay').textContent = history;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('patientWeightDisplay').textContent = `${patientData_DH.weightKg} kg`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('patientConditionDisplay').textContent = `Post-Valve Surgery, LV Recovery, Severe ARDS, on VA ECMO`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('patientCannulaeDisplay').textContent = `Fem-Fem (Access ${patientData_DH.accessCannulaSize}, Return ${patientData_DH.returnCannulaSize})`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>logMessage_DH(`VA ECMO (Differential Hypoxia Scenario V2.0 - Trainer Controls Added) initiated. LV recovering (LVEF ${patientData_DH.nativeLVEF.toFixed(2)}, AoV Factor ${patientData_DH.aorticValveOpeningFactor.toFixed(1)}), severe ARDS (Lung O2 Capacity: ${patientData_DH.nativeLungOxygenationCapacity.toFixed(2)}). Initial R.Arm SpO2 should reflect significant differential hypoxia. Baseline ECMO flow ~4.0 L/min (RPM: ${patientData_DH.ecmoRpm}).`, "narrative");</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Updates all vital signs monitor displays</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateMonitorDisplays_DH() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('hrDisplayValue').textContent = patientData_DH.hr.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('bpDisplayValue').textContent = `${patientData_DH.systolicBP.toFixed(0)}/${patientData_DH.diastolicBP.toFixed(0)}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('meanBpDisplayValue').textContent = patientData_DH.meanBP.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('spo2DisplayValue').textContent = patientData_DH.spO2_femoral.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const spo2RarmDisplay = document.getElementById('spo2RarmDisplayValue');</p>
<p class="p1"><span class="Apple-converted-space">        </span>spo2RarmDisplay.textContent = patientData_DH.spO2_r_arm.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>spo2RarmDisplay.classList.toggle('low-sat', patientData_DH.spO2_r_arm &lt; 90 &amp;&amp; !patientData_DH.vavEcmoActive);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('cvpDisplayValue').textContent = patientData_DH.cvp.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('papDisplayValue').textContent = patientData_DH.paDiastolic.toFixed(0);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('tempDisplayValue').textContent = patientData_DH.temp.toFixed(1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const minutes = Math.floor(patientData_DH.scenarioTime);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const seconds = Math.round((patientData_DH.scenarioTime - minutes) * 60);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('scenarioTimeDisplay').textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Updates ECMO, medication, and cannula status displays</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateControlPanelDisplays_DH() {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>updateDial_DH('rpm', patientData_DH.ecmoRpm, dialSettings_DH.rpm.min, dialSettings_DH.rpm.max);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>updateDial_DH('sweep', patientData_DH.ecmoSweep, dialSettings_DH.sweep.min, dialSettings_DH.sweep.max);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>updateDial_DH('fio2', patientData_DH.ecmoFiO2, dialSettings_DH.fio2.min, dialSettings_DH.fio2.max);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('actualEcmoFlowDisplay').textContent = `${patientData_DH.currentEcmoFlow.toFixed(1)} L/min`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('p1DisplayValue').textContent = patientData_DH.p1.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('p2DisplayValue').textContent = patientData_DH.p2.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('p3DisplayValue').textContent = patientData_DH.p3.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('sedationValue').textContent = patientData_DH.sedationLevel.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('paralyticValue').textContent = patientData_DH.paralyticLevel.toFixed(1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('inotropeValue').textContent = patientData_DH.inotropeLevel.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const accessCannula = document.getElementById('accessCannula');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const returnCannula = document.getElementById('returnCannula');</p>
<p class="p1"><span class="Apple-converted-space">        </span>let accessSatFactor = Math.max(0, Math.min(1, (patientData_DH.preMembranePaO2 - 20) / 40));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>accessCannula.style.backgroundColor = `rgb(${Math.round(20 + 60 * accessSatFactor)}, ${Math.round(80 - 40 * accessSatFactor)}, ${Math.round(100 - 30 * accessSatFactor)})`;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let returnSatFactor = Math.max(0, Math.min(1, (patientData_DH.postMembranePaO2 - 50) / 400));</p>
<p class="p1"><span class="Apple-converted-space">        </span>returnCannula.style.backgroundColor = `rgb(${Math.round(220 * returnSatFactor + 30*(1-returnSatFactor))}, ${Math.round(20 + 10 * returnSatFactor)}, ${Math.round(30 + 10 * returnSatFactor)})`;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Settings for ECMO control dials</p>
<p class="p1"><span class="Apple-converted-space">    </span>const dialSettings_DH = {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>rpm: { min: 1500, max: 5500, step: 100, needleId: 'rpmNeedle', displayId: 'ecmoRpmValueDisplay', patientKey: 'ecmoRpm' },</p>
<p class="p1"><span class="Apple-converted-space">        </span>sweep: { min: 0, max: 12, step: 0.1, needleId: 'sweepNeedle', displayId: 'ecmoSweepValueDisplay', patientKey: 'ecmoSweep' },</p>
<p class="p1"><span class="Apple-converted-space">        </span>fio2: { min: 21, max: 100, step: 1, needleId: 'fio2Needle', displayId: 'ecmoFio2ValueDisplay', patientKey: 'ecmoFiO2' }</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Updates a specific ECMO dial display</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateDial_DH(controlName, value, min, max) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const setting = dialSettings_DH[controlName];</p>
<p class="p1"><span class="Apple-converted-space">        </span>const displayValue = (controlName === 'sweep') ? value.toFixed(1) : value.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById(setting.displayId).textContent = displayValue;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const percentage = (value - min) / (max - min);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const angle = -90 + (percentage * 180);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById(setting.needleId).style.transform = `rotate(${angle}deg)`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Event listeners for ECMO dial control buttons</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.querySelectorAll('.dial-btn').forEach(button =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>button.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (button.disabled) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const control = button.dataset.control; const action = button.dataset.action;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const setting = dialSettings_DH[control]; let currentValue = parseFloat(patientData_DH[setting.patientKey]);</p>
<p class="p1"><span class="Apple-converted-space">            </span>let newValue = currentValue;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (action === 'increase') newValue = Math.min(setting.max, currentValue + setting.step);</p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (action === 'decrease') newValue = Math.max(setting.min, currentValue - setting.step);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (newValue !== currentValue) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH[setting.patientKey] = newValue;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>logAction_DH(`Adjusted VA ECMO ${control.toUpperCase()} to ${ (control === 'sweep') ? newValue.toFixed(1) : newValue.toFixed(0) }.`);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>updateDial_DH(control, newValue, setting.min, setting.max);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                 </span>checkAndApplyVentilatorOptimizationEffect_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                 </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Ventilator settings UI elements</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ventParamsContainer_DH = document.getElementById('ventilatorParamsContainer');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ventModeSelector_DH = document.getElementById('ventModeSelector');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ventilatorSettingsHeader_DH = document.getElementById('ventilatorSettingsHeader');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ventilatorSettingsContent_DH = document.getElementById('ventilatorSettingsContent');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ventilatorToggleIcon_DH = document.getElementById('ventilatorToggleIcon');</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Toggles visibility of ventilator settings card</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (ventilatorSettingsHeader_DH &amp;&amp; ventilatorSettingsContent_DH &amp;&amp; ventilatorToggleIcon_DH) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>ventilatorSettingsHeader_DH.addEventListener('click', () =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (ventilatorSettingsHeader_DH.disabled) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const isExpanded = ventilatorSettingsContent_DH.classList.toggle('expanded');<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>ventilatorSettingsHeader_DH.setAttribute('aria-expanded', isExpanded);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>ventilatorToggleIcon_DH.classList.toggle('rotated', isExpanded);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Creates an input element for a ventilator parameter</p>
<p class="p1"><span class="Apple-converted-space">    </span>function createVentParamInput_DH(label, id, type, value, min, max, step, unit, patientKey) { <span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const div = document.createElement('div'); div.className = 'flex justify-between items-center text-sm py-1';<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const labelEl = document.createElement('label'); labelEl.htmlFor = id; labelEl.className = 'font-medium vent-param-label text-gray-700'; labelEl.textContent = `${label}:`; div.appendChild(labelEl);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const inputWrapper = document.createElement('div'); inputWrapper.className = 'flex items-center space-x-2';</p>
<p class="p1"><span class="Apple-converted-space">        </span>const inputEl = document.createElement('input'); inputEl.type = type; inputEl.id = id; inputEl.value = value; inputEl.min = min; inputEl.max = max; inputEl.step = step; inputEl.dataset.patientKey = patientKey; inputEl.className = 'w-24 p-1.5 border border-gray-300 rounded-md text-sm focus:ring-blue-500 focus:border-blue-500 bg-white text-right';</p>
<p class="p1"><span class="Apple-converted-space">        </span>inputEl.addEventListener('input', (e) =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const val = parseFloat(e.target.value);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH[e.target.dataset.patientKey] = val;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>logAction_DH(`Adjusted Ventilator ${label} to ${val.toFixed(e.target.step.includes('.') ? 1 : 0)} ${unit}.`);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">            </span>checkAndApplyVentilatorOptimizationEffect_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>inputWrapper.appendChild(inputEl);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (unit) { const unitEl = document.createElement('span'); unitEl.className = 'vent-param-unit text-gray-500 text-xs'; unitEl.textContent = unit; inputWrapper.appendChild(unitEl); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>div.appendChild(inputWrapper); return div;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Renders ventilator parameter inputs based on the selected mode</p>
<p class="p1"><span class="Apple-converted-space">    </span>function renderVentilatorParams_DH() {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ventParamsContainer_DH.innerHTML = ''; const mode = patientData_DH.ventMode;</p>
<p class="p1"><span class="Apple-converted-space">        </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('FiO2', 'ventFio2Input', 'number', patientData_DH.ventFiO2, 21, 100, 1, '%', 'ventFiO2'));</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (mode === 'PCV_AC') {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('Insp Pressure', 'ventPIP_PCVACInput', 'number', patientData_DH.ventPIP_PCVAC, 15, 35, 1, 'cmH2O', 'ventPIP_PCVAC'));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('PEEP', 'ventPEEP_PCVACInput', 'number', patientData_DH.ventPEEP_PCVAC, 8, 24, 1, 'cmH2O', 'ventPEEP_PCVAC')); <span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('Rate', 'ventRR_PCVACInput', 'number', patientData_DH.ventRR_PCVAC, 10, 25, 1, 'bpm', 'ventRR_PCVAC'));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (mode === 'APRV') {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">             </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('P-High', 'ventPHigh_APRVInput', 'number', patientData_DH.ventPHigh_APRV, 20, 35, 1, 'cmH2O', 'ventPHigh_APRV'));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">             </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('P-Low', 'ventPLow_APRVInput', 'number', patientData_DH.ventPLow_APRV, 0, 15, 1, 'cmH2O', 'ventPLow_APRV'));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">             </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('T-High', 'ventTHigh_APRVInput', 'number', patientData_DH.ventTHigh_APRV, 1.0, 5.0, 0.1, 's', 'ventTHigh_APRV'));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">             </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('T-Low', 'ventTLow_APRVInput', 'number', patientData_DH.ventTLow_APRV, 0.2, 1.0, 0.1, 's', 'ventTLow_APRV'));</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (mode === 'PRVC') {</p>
<p class="p1"><span class="Apple-converted-space">            </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('Target Vt', 'ventTargetVt_PRVCInput', 'number', patientData_DH.ventTargetVt_PRVC, 200, 600, 10, 'mL', 'ventTargetVt_PRVC'));</p>
<p class="p1"><span class="Apple-converted-space">            </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('Max Pressure', 'ventMaxP_PRVCInput', 'number', patientData_DH.ventMaxP_PRVC, 25, 40, 1, 'cmH2O', 'ventMaxP_PRVC'));</p>
<p class="p1"><span class="Apple-converted-space">            </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('PEEP', 'ventPEEP_PRVCInput', 'number', patientData_DH.ventPEEP_PRVC, 8, 24, 1, 'cmH2O', 'ventPEEP_PRVC'));</p>
<p class="p1"><span class="Apple-converted-space">            </span>ventParamsContainer_DH.appendChild(createVentParamInput_DH('Rate', 'ventRR_PRVCInput', 'number', patientData_DH.ventRR_PRVC, 10, 25, 1, 'bpm', 'ventRR_PRVC'));</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateVentilatorWaveform_DH();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Event listener for ventilator mode change</p>
<p class="p1"><span class="Apple-converted-space">    </span>ventModeSelector_DH.addEventListener('change', (e) =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (ventModeSelector_DH.disabled) return;</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.ventMode = e.target.value;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>logAction_DH(`Changed ventilator mode to ${patientData_DH.ventMode}.`, "intervention");<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>renderVentilatorParams_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>checkAndApplyVentilatorOptimizationEffect_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Initializes the ventilator waveform chart</p>
<p class="p1"><span class="Apple-converted-space">    </span>function initVentilatorWaveform_DH() {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const ctx = document.getElementById('ventilatorWaveformChart').getContext('2d'); Chart.defaults.font.family = "'Inter', sans-serif";<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ventilatorWaveformChart_DH = new Chart(ctx, { type: 'line', data: { labels: [], datasets: [{ label: 'Airway Pressure', data: [], borderColor: '#007aff', backgroundColor: 'rgba(0, 122, 255, 0.1)', borderWidth: 2, pointRadius: 0, tension: 0.2 }] }, options: { responsive: true, maintainAspectRatio: false, animation: false, scales: { x: { type: 'linear', display: true, title: { display: true, text: 'Time (s)', color: '#6b7280'}, ticks: { color: '#6b7280', font: {size: 10} }, grid: { color: '#e5e7eb'}}, y: { display: true, title: { display: true, text: 'Pressure (cmH2O)', color: '#6b7280'}, min: 0, max: 40, ticks: { color: '#6b7280', stepSize: 5, font: {size: 10} }, grid: { color: '#e5e7eb'}} }, plugins: { legend: { display: false } } } });</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Updates the ventilator waveform display</p>
<p class="p1"><span class="Apple-converted-space">    </span>let waveformTime_DH = 0; const waveformTimeStep_DH = 0.4; const waveformWindow_DH = 10;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateVentilatorWaveform_DH() {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!ventilatorWaveformChart_DH) return;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const data = ventilatorWaveformChart_DH.data; const now = waveformTime_DH; let pressure = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (patientData_DH.ventMode === 'PCV_AC') { const cycleTime = 60 / Math.max(1, patientData_DH.ventRR_PCVAC); const inspTime = 0.8; const timeInCycle = now % cycleTime; pressure = (timeInCycle &lt; inspTime) ? patientData_DH.ventPIP_PCVAC : patientData_DH.ventPEEP_PCVAC; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (patientData_DH.ventMode === 'APRV') { const cycleTime = patientData_DH.ventTHigh_APRV + patientData_DH.ventTLow_APRV; if (cycleTime &lt;=0) pressure = 0; else { const timeInCycle = now % cycleTime; pressure = (timeInCycle &lt; patientData_DH.ventTHigh_APRV) ? patientData_DH.ventPHigh_APRV : patientData_DH.ventPLow_APRV; }}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (patientData_DH.ventMode === 'PRVC') { const cycleTime = 60 / Math.max(1, patientData_DH.ventRR_PRVC); const inspTime = 0.8; const timeInCycle = now % cycleTime; pressure = (timeInCycle &lt; inspTime) ? Math.min(patientData_DH.ventMaxP_PRVC, patientData_DH.ventPEEP_PRVC + 10 + Math.random()*5) : patientData_DH.ventPEEP_PRVC; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>else { pressure = patientData_DH.ventPEEP_PCVAC || patientData_DH.ventPEEP_PRVC || patientData_DH.ventPLow_APRV || 10; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>data.labels.push(now.toFixed(1)); data.datasets[0].data.push(pressure);</p>
<p class="p1"><span class="Apple-converted-space">        </span>while (data.labels.length &gt; waveformWindow_DH / waveformTimeStep_DH) { data.labels.shift(); data.datasets[0].data.shift(); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lastTime = parseFloat(data.labels[data.labels.length - 1] || 0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>ventilatorWaveformChart_DH.options.scales.x.min = Math.max(0, lastTime - waveformWindow_DH + waveformTimeStep_DH);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ventilatorWaveformChart_DH.options.scales.x.max = Math.max(waveformWindow_DH, lastTime + waveformTimeStep_DH);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>ventilatorWaveformChart_DH.update('none'); waveformTime_DH += waveformTimeStep_DH;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Creates a generic waveform chart</p>
<p class="p1"><span class="Apple-converted-space">    </span>function createWaveformChart_DH(canvasId, color, yMin = 0, yMax = 100) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const ctx = document.getElementById(canvasId).getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">        </span>return new Chart(ctx, { type: 'line', data: { labels: Array(WAVEFORM_POINTS_DISPLAYED_DH).fill(0).map((_, i) =&gt; i * (fastUpdateInterval_DH / 1000)), datasets: [{ data: Array(WAVEFORM_POINTS_DISPLAYED_DH).fill(yMin), borderColor: color, borderWidth: 1.5, pointRadius: 0, tension: 0.2, fill: false }] }, options: { responsive: true, maintainAspectRatio: false, animation: false, scales: { x: { display: false }, y: { display: false, min: yMin, max: yMax } }, plugins: { legend: { display: false }, tooltip: { enabled: false } }, elements: { line: { tension: 0.4 } } } });</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Initializes all physiological waveform charts (ECG, ART, SpO2 Pleth)</p>
<p class="p1"><span class="Apple-converted-space">    </span>function initAllWaveforms_DH() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>ecgWaveformChart_DH = createWaveformChart_DH('ecgWaveformChart', '#30d158', -1.5, 2.5);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>arterialLineChart_DH = createWaveformChart_DH('arterialLineChart', '#ff453a', 0, 180);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>spo2PlethWaveformChart_DH = createWaveformChart_DH('spo2PlethWaveformChart', '#0a84ff', 0, 100);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Updates ECG waveform</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateEcgWaveform_DH() {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!ecgWaveformChart_DH) return; const data = ecgWaveformChart_DH.data.datasets[0].data; const labels = ecgWaveformChart_DH.data.labels; const HR = patientData_DH.hr; const pointsToGenerate = Math.max(1, Math.round((fastUpdateInterval_DH / 1000) * 50));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>for (let i = 0; i &lt; pointsToGenerate; i++) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>let ecgPoint = 0; const beatDuration = 60 / Math.max(1, HR); const phase = ecgWaveformPhase_DH;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (phase &gt;= 0 &amp;&amp; phase &lt; 0.08 / beatDuration) { ecgPoint = 0.15 * Math.sin((phase * beatDuration / 0.08) * Math.PI); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>const qrsStart = 0.12 / beatDuration; const qrsEnd = (0.12 + 0.09) / beatDuration;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (phase &gt;= qrsStart &amp;&amp; phase &lt; qrsEnd) { const qrsPhase = (phase - qrsStart) / (qrsEnd - qrsStart); if (qrsPhase &lt; 0.15) ecgPoint = -0.2 * Math.sin(qrsPhase / 0.15 * Math.PI); else if (qrsPhase &lt; 0.5) ecgPoint = 1.5 * Math.sin((qrsPhase - 0.15) / 0.35 * Math.PI); else ecgPoint = -0.4 * Math.sin((qrsPhase - 0.5) / 0.5 * Math.PI); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>const tStart = (0.12 + 0.09 + 0.08) / beatDuration; const tEnd = tStart + 0.20 / beatDuration;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (phase &gt;= tStart &amp;&amp; phase &lt; tEnd) { ecgPoint = 0.3 * Math.sin((phase - tStart) / (tEnd - tStart) * Math.PI); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>data.push(ecgPoint); labels.push(labels.length * (fastUpdateInterval_DH / 1000 / pointsToGenerate));</p>
<p class="p1"><span class="Apple-converted-space">            </span>ecgWaveformPhase_DH += (fastUpdateInterval_DH / 1000 / pointsToGenerate) / beatDuration;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (ecgWaveformPhase_DH &gt;= 1.0) ecgWaveformPhase_DH = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>while (data.length &gt; WAVEFORM_POINTS_DISPLAYED_DH) { data.shift(); labels.shift(); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>ecgWaveformChart_DH.update('none');</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Updates Arterial Line waveform</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateArterialLineChart_DH() {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!arterialLineChart_DH) return; const data = arterialLineChart_DH.data.datasets[0].data; const labels = arterialLineChart_DH.data.labels; const SBP = patientData_DH.systolicBP; const DBP = patientData_DH.diastolicBP; const HR = patientData_DH.hr; const pulsePressure = Math.max(5, SBP - DBP); const pointsToGenerate = Math.max(1, Math.round( (fastUpdateInterval_DH / 1000) * 50) );<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>for (let i = 0; i &lt; pointsToGenerate; i++) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>let pressure; const phase = artLineWaveformPhase_DH; const effectivePulsePressure = pulsePressure * Math.max(0.1, patientData_DH.aorticValveOpeningFactor); const nativeEjectionComponent = patientData_DH.aorticValveOpeningFactor * (0.5 + patientData_DH.nativeLVEF * 1.5 + (patientData_DH.inotropeLevel / 10) * 0.1);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (phase &lt; 0.15) { pressure = DBP + (effectivePulsePressure * nativeEjectionComponent * Math.pow(phase / 0.15, 2)); }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (phase &lt; 0.30) { pressure = (SBP * nativeEjectionComponent + DBP * (1-nativeEjectionComponent)) - (effectivePulsePressure * nativeEjectionComponent * 0.1 * Math.sin((phase - 0.15) / 0.15 * Math.PI));}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (phase &lt; 0.40) { const notchBase = DBP + effectivePulsePressure * nativeEjectionComponent * 0.7; const notchHeight = effectivePulsePressure * nativeEjectionComponent * (0.05 + patientData_DH.aorticValveOpeningFactor * 0.05) ; pressure = notchBase + notchHeight * Math.sin((phase - 0.30) / 0.10 * Math.PI); }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>else { const remainingPhase = phase - 0.40; const decayFactor = Math.pow(remainingPhase / 0.60, 2); pressure = (DBP + effectivePulsePressure * nativeEjectionComponent * 0.7) - (effectivePulsePressure * nativeEjectionComponent * 0.7 * decayFactor); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>pressure = Math.max(DBP - 10, Math.min(SBP + 10, pressure));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>data.push(pressure); labels.push(labels.length * (fastUpdateInterval_DH / 1000 / pointsToGenerate) );<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const beatDuration = 60 / Math.max(1, HR); artLineWaveformPhase_DH += (fastUpdateInterval_DH / 1000 / pointsToGenerate) / beatDuration;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (artLineWaveformPhase_DH &gt;= 1.0) { artLineWaveformPhase_DH = 0; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>while (data.length &gt; WAVEFORM_POINTS_DISPLAYED_DH) { data.shift(); labels.shift(); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>arterialLineChart_DH.options.scales.y.min = Math.max(0, DBP - 20); arterialLineChart_DH.options.scales.y.max = Math.min(200, SBP + 30); arterialLineChart_DH.update('none');<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Updates SpO2 Plethysmograph waveform</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateSpo2PlethWaveform_DH() {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!spo2PlethWaveformChart_DH) return; const data = spo2PlethWaveformChart_DH.data.datasets[0].data; const labels = spo2PlethWaveformChart_DH.data.labels; const HR = patientData_DH.hr; const spo2ValueToReflect = patientData_DH.spO2_r_arm; const pointsToGenerate = Math.max(1, Math.round((fastUpdateInterval_DH / 1000) * 50));</p>
<p class="p1"><span class="Apple-converted-space">        </span>for (let i = 0; i &lt; pointsToGenerate; i++) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>let plethPoint = 0; const beatDuration = 60 / Math.max(1, HR); const phase = spo2PlethWaveformPhase_DH;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const baseAmplitude = 30 + (spo2ValueToReflect / 100) * 40; const pulseAmplitude = baseAmplitude * 0.6 * Math.max(0.2, patientData_DH.aorticValveOpeningFactor);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (phase &lt; 0.3 / beatDuration) { plethPoint = baseAmplitude - pulseAmplitude + pulseAmplitude * Math.sin((phase * beatDuration / 0.3) * (Math.PI / 2)); }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (phase &lt; 0.4 / beatDuration) { const notchPhase = (phase - 0.3 / beatDuration) / (0.1 / beatDuration); plethPoint = baseAmplitude - (pulseAmplitude * 0.15 * Math.sin(notchPhase * Math.PI)); }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>else { const diastolePhase = (phase - 0.4 / beatDuration) / ((beatDuration - 0.4) / beatDuration); plethPoint = (baseAmplitude - pulseAmplitude * 0.15) * Math.exp(-diastolePhase * 2.5); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>plethPoint = Math.max(0, Math.min(100, plethPoint + (Math.random()-0.5)*5 ));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>data.push(plethPoint); labels.push(labels.length * (fastUpdateInterval_DH / 1000 / pointsToGenerate));</p>
<p class="p1"><span class="Apple-converted-space">            </span>spo2PlethWaveformPhase_DH += (fastUpdateInterval_DH / 1000 / pointsToGenerate) / beatDuration;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (spo2PlethWaveformPhase_DH &gt;= 1.0) spo2PlethWaveformPhase_DH = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>while (data.length &gt; WAVEFORM_POINTS_DISPLAYED_DH) { data.shift(); labels.shift(); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>spo2PlethWaveformChart_DH.update('none');</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Main physiological calculation engine</p>
<p class="p1"><span class="Apple-converted-space">    </span>function calculateDerivedPhysiology_DH() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.p1 = -15 - (patientData_DH.ecmoRpm / 150) - (patientData_DH.cvp * 0.6); patientData_DH.p1 = Math.max(-150, patientData_DH.p1);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let potentialFlow = (patientData_DH.ecmoRpm - 1000) / (450);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let p1EffectOnFlow = (1 - Math.abs(patientData_DH.p1 / 300));</p>
<p class="p1"><span class="Apple-converted-space">        </span>p1EffectOnFlow = Math.max(0.5, Math.min(1, p1EffectOnFlow));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.currentEcmoFlow = Math.max(0.5, Math.min(7.0, potentialFlow * p1EffectOnFlow));</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.p2 = patientData_DH.p1 + (patientData_DH.ecmoRpm / 7.5) + (patientData_DH.currentEcmoFlow * 20); patientData_DH.p3 = patientData_DH.p2 - 35 - (patientData_DH.currentEcmoFlow * 7);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let nativeCardiacOutput = patientData_DH.nativeLVEF * (patientData_DH.weightKg / 15) * patientData_DH.aorticValveOpeningFactor; nativeCardiacOutput *= (1 + patientData_DH.inotropeLevel * 0.05); nativeCardiacOutput = Math.max(0.5, nativeCardiacOutput);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let totalSystemicFlow = patientData_DH.currentEcmoFlow + nativeCardiacOutput; let systemicVascularResistanceFactor = 1.0 - (patientData_DH.sedationLevel / 200);</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.meanBP = (totalSystemicFlow * 80 * systemicVascularResistanceFactor) / (patientData_DH.weightKg / 12); patientData_DH.meanBP = Math.max(45, Math.min(110, patientData_DH.meanBP));</p>
<p class="p1"><span class="Apple-converted-space">        </span>let pulsePressure = nativeCardiacOutput * 25 * patientData_DH.aorticValveOpeningFactor; pulsePressure = Math.max(10, Math.min(60, pulsePressure));</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.diastolicBP = patientData_DH.meanBP - (pulsePressure / 3); patientData_DH.systolicBP = patientData_DH.diastolicBP + pulsePressure;</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.diastolicBP = Math.max(30, Math.min(90, patientData_DH.diastolicBP)); patientData_DH.systolicBP = Math.max(patientData_DH.diastolicBP + 5, Math.min(160, patientData_DH.systolicBP));</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.hr = 95 + (patientData_DH.nativeLVEF * 20) - (patientData_DH.sedationLevel * 0.2) + (patientData_DH.inotropeLevel * 1.0) + (patientData_DH.lactate - 1.5)*2; patientData_DH.hr = Math.max(60, Math.min(140, patientData_DH.hr));</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let ventPaO2BaseContribution = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (patientData_DH.ventMode === "PCV_AC") ventPaO2BaseContribution = (patientData_DH.ventFiO2 * 0.5 + patientData_DH.ventPEEP_PCVAC * 2.0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (patientData_DH.ventMode === "APRV") ventPaO2BaseContribution = (patientData_DH.ventFiO2 * 0.5 + ((patientData_DH.ventPHigh_APRV + patientData_DH.ventPLow_APRV)/2 * 1.5) );</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (patientData_DH.ventMode === "PRVC") ventPaO2BaseContribution = (patientData_DH.ventFiO2 * 0.5 + patientData_DH.ventPEEP_PRVC * 2.0);</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let paO2_native_lungs;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (patientData_DH.vavEcmoActive) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>paO2_native_lungs = patientData_DH.postMembranePaO2 * 0.85;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>paO2_native_lungs = Math.max(150, Math.min(500, paO2_native_lungs));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>let paO2_from_vent_and_capacity = ventPaO2BaseContribution * patientData_DH.nativeLungOxygenationCapacity;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (patientData_DH.inhaledNOPulmonaryVasodilatorActive) paO2_from_vent_and_capacity *= 1.2;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>paO2_native_lungs = Math.max(patientData_DH.paO2_native_lungs_floor, Math.min(150, paO2_from_vent_and_capacity));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.postMembranePaO2 = patientData_DH.ecmoFiO2 * 5.0; patientData_DH.postMembranePaO2 = Math.max(100, Math.min(600, patientData_DH.postMembranePaO2));</p>
<p class="p1"><span class="Apple-converted-space">        </span>let nativeCO_fraction_upper = nativeCardiacOutput / (nativeCardiacOutput + patientData_DH.currentEcmoFlow * 0.1 + 0.01);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let mixing_adjustment_for_AoV_opening = (1 - patientData_DH.aorticValveOpeningFactor * 0.8);</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.po2_r_radial = (paO2_native_lungs * nativeCO_fraction_upper) + (patientData_DH.postMembranePaO2 * (1 - nativeCO_fraction_upper) * mixing_adjustment_for_AoV_opening);</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (nativeCO_fraction_upper &gt; 0.95 &amp;&amp; !patientData_DH.vavEcmoActive) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">             </span>patientData_DH.po2_r_radial = Math.max(patientData_DH.po2_r_radial, paO2_native_lungs);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (!patientData_DH.vavEcmoActive) {</p>
<p class="p1"><span class="Apple-converted-space">             </span>patientData_DH.po2_r_radial = Math.max(patientData_DH.paO2_native_lungs_floor, patientData_DH.po2_r_radial);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>let nativeCO_fraction_lower = nativeCardiacOutput / (nativeCardiacOutput + patientData_DH.currentEcmoFlow + 0.01);</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.po2_systemic = (paO2_native_lungs * nativeCO_fraction_lower * 0.3) + (patientData_DH.postMembranePaO2 * (1 - nativeCO_fraction_lower * 0.3));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.po2_systemic = Math.max(30, patientData_DH.po2_systemic);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const p50 = 27; const hill = 2.7;</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.spO2_r_arm = 100 * (Math.pow(patientData_DH.po2_r_radial, hill) / (Math.pow(p50, hill) + Math.pow(patientData_DH.po2_r_radial, hill))); patientData_DH.spO2_r_arm = Math.min(100, Math.max(30, patientData_DH.spO2_r_arm));</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.spO2_femoral = 100 * (Math.pow(patientData_DH.po2_systemic, hill) / (Math.pow(p50, hill) + Math.pow(patientData_DH.po2_systemic, hill))); patientData_DH.spO2_femoral = Math.min(100, Math.max(35, patientData_DH.spO2_femoral));</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let pco2_r_radial_calc = patientData_DH.postMembranePaCO2 + (nativeCO_fraction_upper * 15 * (1- (patientData_DH.vavEcmoActive ? 0.8 : patientData_DH.nativeLungOxygenationCapacity) ));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.pco2_r_radial = Math.max(20, Math.min(90, pco2_r_radial_calc));</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.ph_r_radial = 7.40 - ((patientData_DH.pco2_r_radial - 40) * 0.008) - (( (patientData_DH.vavEcmoActive ? 150 : 50) - patientData_DH.po2_r_radial)*0.001);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.hco3_r_radial = 24 + (patientData_DH.ph_r_radial - 7.40)*20 - (patientData_DH.pco2_r_radial - 40)*0.1;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.ph_r_radial = Math.max(6.9, Math.min(7.6, patientData_DH.ph_r_radial));</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.hco3_r_radial = Math.max(10, Math.min(35, patientData_DH.hco3_r_radial));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.preMembranePaCO2 = 48 + patientData_DH.lactate * 0.8 - ( (patientData_DH.vavEcmoActive ? 0.8 : patientData_DH.nativeLungOxygenationCapacity) * 5);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.postMembranePaCO2 = Math.max(15, patientData_DH.preMembranePaCO2 - (patientData_DH.ecmoSweep * 5.0));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.pco2_systemic = patientData_DH.postMembranePaCO2 + (nativeCO_fraction_lower * 10 * (1-(patientData_DH.vavEcmoActive ? 0.8 : patientData_DH.nativeLungOxygenationCapacity))); patientData_DH.pco2_systemic = Math.max(20, Math.min(70, patientData_DH.pco2_systemic));</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.hco3_systemic = 24 - (patientData_DH.lactate - 1.0) * 1.5 - (patientData_DH.pco2_systemic - 40) * 0.2; patientData_DH.hco3_systemic = Math.max(10, Math.min(35, patientData_DH.hco3_systemic));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.ph_systemic = 6.1 + Math.log10(Math.max(1, patientData_DH.hco3_systemic) / (0.0301 * Math.max(10, patientData_DH.pco2_systemic))); patientData_DH.ph_systemic = Math.max(6.90, Math.min(7.60, patientData_DH.ph_systemic));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.be_systemic = (0.9287 * patientData_DH.hco3_systemic) + (13.77 * patientData_DH.ph_systemic) - 124.58;<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Lactate calculation only if not overridden by trainer</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (document.getElementById('trainerLactateInput').value === patientData_DH.lactate.toFixed(1)) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>let lactateProduction = 0.01;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (patientData_DH.meanBP &lt; 60) lactateProduction += (60 - patientData_DH.meanBP) * 0.0012;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (patientData_DH.spO2_r_arm &lt; 85 &amp;&amp; !patientData_DH.vavEcmoActive) lactateProduction += (85 - patientData_DH.spO2_r_arm) * 0.0008;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (patientData_DH.currentEcmoFlow &lt; (patientData_DH.weightKg * 0.030)) lactateProduction += 0.005;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>let lactateClearance = 0.015 + (patientData_DH.currentEcmoFlow / (patientData_DH.weightKg * 0.06)) * 0.01;</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.lactate += (lactateProduction - lactateClearance);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.lactate = Math.max(0.8, Math.min(15, patientData_DH.lactate));</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// CVP calculation only if not overridden by trainer</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (document.getElementById('trainerCvpInput').value === patientData_DH.cvp.toFixed(0)) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.cvp = 8 + (patientData_DH.nativeLVEF * 10) - (patientData_DH.currentEcmoFlow*0.5);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.cvp = Math.max(3, Math.min(22, patientData_DH.cvp));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.paDiastolic = 20 + (1-(patientData_DH.vavEcmoActive ? 0.8 : patientData_DH.nativeLungOxygenationCapacity))*15 + patientData_DH.cvp * 0.3; patientData_DH.paDiastolic = Math.max(15, Math.min(50, patientData_DH.paDiastolic));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Advances scenario state at each simulation interval</p>
<p class="p1"><span class="Apple-converted-space">    </span>function advanceScenarioState_DH() {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.scenarioTime += (simulationInterval_DH / 1000 / 60);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>calculateDerivedPhysiology_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>checkAndApplyVentilatorOptimizationEffect_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Trainer control values are already part of patientData_DH, so they influence calculateDerivedPhysiology</p>
<p class="p1"><span class="Apple-converted-space">        </span>// No need to re-read from trainer inputs here, they are event-driven.</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Info modal elements and functions</p>
<p class="p1"><span class="Apple-converted-space">    </span>const infoModal_DH = document.getElementById('infoModal');<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>const modalTitle_DH = document.getElementById('modalTitle');<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>const modalBody_DH = document.getElementById('modalBody');</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>function showInfoModal_DH(title, bodyContent) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>modalTitle_DH.textContent = title; modalBody_DH.innerHTML = bodyContent; infoModal_DH.classList.add('active');<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById('closeModalButton').addEventListener('click', () =&gt; infoModal_DH.classList.remove('active'));</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Checks and applies effect of ventilator optimization if conditions are met</p>
<p class="p1"><span class="Apple-converted-space">    </span>function checkAndApplyVentilatorOptimizationEffect_DH() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (patientData_DH.awaitingVentOptimization &amp;&amp; patientData_DH.nativeLungOxygenationCapacity &lt;= 0.01) { // Only try to improve if capacity is bad</p>
<p class="p1"><span class="Apple-converted-space">            </span>const ventFiO2Optimized = patientData_DH.ventFiO2 &gt;= 100;</p>
<p class="p1"><span class="Apple-converted-space">            </span>let peepOptimized = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (patientData_DH.ventMode === "PCV_AC" &amp;&amp; patientData_DH.ventPEEP_PCVAC &gt;= 14) peepOptimized = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (patientData_DH.ventMode === "PRVC" &amp;&amp; patientData_DH.ventPEEP_PRVC &gt;= 14) peepOptimized = true;</p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (patientData_DH.ventMode === "APRV" &amp;&amp; patientData_DH.ventPLow_APRV &gt;= 6) peepOptimized = true;<span class="Apple-converted-space"> </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const lastAction = patientData_DH.actionsTaken.length &gt; 0 ? patientData_DH.actionsTaken[patientData_DH.actionsTaken.length -1] : null;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const optimizeStrategyIntervention = lastAction &amp;&amp; lastAction.action.toLowerCase().includes("optimize ventilator strategy");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (ventFiO2Optimized || peepOptimized || optimizeStrategyIntervention) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.nativeLungOxygenationCapacity = 0.20; // Improvement</p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.awaitingVentOptimization = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>logAction_DH("Ventilator optimization achieved. Native lung O2 capacity improved to 0.20.", "success");</p>
<p class="p1"><span class="Apple-converted-space">                </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (patientData_DH.nativeLungOxygenationCapacity &gt; 0.01) {</p>
<p class="p1"><span class="Apple-converted-space">             </span>// If lung capacity is already good (e.g. set by trainer), no longer awaiting optimization for this specific event trigger.</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.awaitingVentOptimization = false;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Handles selected interventions</p>
<p class="p1"><span class="Apple-converted-space">    </span>function performIntervention_DH(interventionValue) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const interventionOptionElement = document.querySelector(`#interventionOptions a[data-value="${interventionValue}"]`);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const interventionFriendlyName = interventionOptionElement ? interventionOptionElement.textContent : "Unknown Intervention";</p>
<p class="p1"><span class="Apple-converted-space">        </span>switch (interventionValue) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'increase_vent_fio2':<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.ventFiO2 = Math.min(100, patientData_DH.ventFiO2 + 10);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>logAction_DH(`Increased ventilator FiO2 to ${patientData_DH.ventFiO2}%.`, "intervention");<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>document.querySelector('#ventilatorParamsContainer input[data-patient-key="ventFiO2"]').value = patientData_DH.ventFiO2;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'increase_vent_peep':</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (patientData_DH.ventMode === "PCV_AC") { patientData_DH.ventPEEP_PCVAC = Math.min(24, patientData_DH.ventPEEP_PCVAC + 2); document.querySelector('#ventilatorParamsContainer input[data-patient-key="ventPEEP_PCVAC"]').value = patientData_DH.ventPEEP_PCVAC; logAction_DH(`Increased PCV PEEP to ${patientData_DH.ventPEEP_PCVAC} cmH2O.`, "intervention");}</p>
<p class="p1"><span class="Apple-converted-space">                </span>else if (patientData_DH.ventMode === "APRV") { patientData_DH.ventPLow_APRV = Math.min(15, patientData_DH.ventPLow_APRV + 1); document.querySelector('#ventilatorParamsContainer input[data-patient-key="ventPLow_APRV"]').value = patientData_DH.ventPLow_APRV; logAction_DH(`Increased APRV P-Low to ${patientData_DH.ventPLow_APRV} cmH2O.`, "intervention");}</p>
<p class="p1"><span class="Apple-converted-space">                </span>else if (patientData_DH.ventMode === "PRVC") { patientData_DH.ventPEEP_PRVC = Math.min(24, patientData_DH.ventPEEP_PRVC + 2); document.querySelector('#ventilatorParamsContainer input[data-patient-key="ventPEEP_PRVC"]').value = patientData_DH.ventPEEP_PRVC; logAction_DH(`Increased PRVC PEEP to ${patientData_DH.ventPEEP_PRVC} cmH2O.`, "intervention");}</p>
<p class="p1"><span class="Apple-converted-space">                </span>break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'optimize_vent_strategy':<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>logAction_DH("Selected: Optimize Ventilator Strategy. Effect depends on subsequent specific adjustments or if conditions for lung improvement are met.", "intervention");<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>showInfoModal_DH("Ventilator Strategy Optimization", "Consider recruitment maneuvers, adjust APRV T-High/T-Low, or PCV I-time/Rate to improve mean airway pressure and oxygenation, balancing lung protection. If lung capacity is critically low due to a scenario event, achieving optimal FiO2/PEEP may now improve it.");<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>break;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'increase_ecmo_flow':<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.ecmoRpm = Math.min(dialSettings_DH.rpm.max, patientData_DH.ecmoRpm + 200);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>logAction_DH(`Increased ECMO RPM to ${patientData_DH.ecmoRpm}.`, "intervention");<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'decrease_ecmo_flow':<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.ecmoRpm = Math.max(dialSettings_DH.rpm.min, patientData_DH.ecmoRpm - 200);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>logAction_DH(`Decreased ECMO RPM to ${patientData_DH.ecmoRpm}.`, "intervention");<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'admin_vasodilator_pulm': patientData_DH.inhaledNOPulmonaryVasodilatorActive = true; logAction_DH("Administered inhaled pulmonary vasodilator.", "intervention"); document.getElementById('trainerInhaledNoToggle').checked = true; break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'admin_beta_blocker_careful': patientData_DH.nativeLVEF = Math.max(0.15, patientData_DH.nativeLVEF - 0.03); patientData_DH.aorticValveOpeningFactor = Math.max(0.2, patientData_DH.aorticValveOpeningFactor - 0.05); logAction_DH("Administered small dose beta-blocker.", "intervention"); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'fluid_challenge_careful': patientData_DH.cvp += 2; logAction_DH("Administered fluid challenge (250ml).", "intervention"); document.getElementById('trainerCvpInput').value = patientData_DH.cvp.toFixed(0); document.getElementById('trainerCvpValue').textContent = patientData_DH.cvp.toFixed(0); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'consult_cardiac_surgery_ecmo': logAction_DH("Consulted Cardiac Surgery / ECMO Specialist.", "event"); showInfoModal_DH("Specialist Consult", "Discussion: Severity of differential hypoxia, impact on end-organ perfusion, feasibility/risks of VAV ECMO or other advanced strategies."); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'initiate_vav_ecmo':</p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.vavEcmoActive = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.differentialHypoxiaActive = false;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.awaitingVentOptimization = false;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>logAction_DH("VAV ECMO Initiated. Expect significant improvement in upper body oxygenation.", "success");</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('trainerVavEcmoToggle').checked = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>default: logMessage_DH("No intervention selected or invalid value.", "warning"); return;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('interventionSelectedText').textContent = "Select Action/Procedure..."; document.getElementById('interventionSelectedValue').value = "";<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>checkAndApplyVentilatorOptimizationEffect_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateTrainerControlDisplays_DH(); // Ensure trainer controls reflect intervention changes</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Handles selected diagnostic tests</p>
<p class="p1"><span class="Apple-converted-space">    </span>function submitDiagnostic_DH(diagnosticValue) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const diagnosticOptionElement = document.querySelector(`#diagnosticOptions a[data-value="${diagnosticValue}"]`);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const diagnosticFriendlyName = diagnosticOptionElement ? diagnosticOptionElement.textContent : "Unknown Diagnostic";</p>
<p class="p1"><span class="Apple-converted-space">        </span>let title = "", results = {}, findings = "";</p>
<p class="p1"><span class="Apple-converted-space">        </span>switch (diagnosticValue) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'abg_paired_radial_femoral': title = "Paired Arterial Blood Gas Report";</p>
<p class="p1"><span class="Apple-converted-space">                </span>results = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"&lt;b&gt;Right Radial Artery (Upper Body)&lt;/b&gt;": "",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>"<span class="Apple-converted-space">  </span>pH (R.Radial)": patientData_DH.ph_r_radial.toFixed(2),<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>"<span class="Apple-converted-space">  </span>PaCO2 (R.Radial)": `${patientData_DH.pco2_r_radial.toFixed(0)} mmHg`,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>"<span class="Apple-converted-space">  </span>PaO2 (R.Radial)": `${patientData_DH.po2_r_radial.toFixed(0)} mmHg (Expected SpO2: ${patientData_DH.spO2_r_arm.toFixed(0)}%)`,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>"<span class="Apple-converted-space">  </span>HCO3 (R.Radial)": `${patientData_DH.hco3_r_radial.toFixed(0)} mmol/L`,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"&lt;b&gt;Femoral Artery / ECMO Return (Lower Body/Systemic)&lt;/b&gt;": "",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>"<span class="Apple-converted-space">  </span>pH (Systemic)": patientData_DH.ph_systemic.toFixed(2),<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>"<span class="Apple-converted-space">  </span>PaCO2 (Systemic)": `${patientData_DH.pco2_systemic.toFixed(0)} mmHg`,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>"<span class="Apple-converted-space">  </span>PaO2 (Systemic)": `${patientData_DH.po2_systemic.toFixed(0)} mmHg (Expected SpO2: ${patientData_DH.spO2_femoral.toFixed(0)}%)`,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>"<span class="Apple-converted-space">  </span>HCO3 (Systemic)": `${patientData_DH.hco3_systemic.toFixed(0)} mmol/L`,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>"<span class="Apple-converted-space">  </span>BE (Systemic)": `${patientData_DH.be_systemic.toFixed(1)} mmol/L`,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>"&lt;b&gt;Lactate (Systemic)&lt;/b&gt;": `${patientData_DH.lactate.toFixed(1)} mmol/L`</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p1"><span class="Apple-converted-space">                </span>let interpretation = `&lt;p class='mt-3 text-sm font-semibold'&gt;Interpretation:&lt;/p&gt;&lt;p class='text-xs'&gt;The PaO2 in the right radial artery (${patientData_DH.po2_r_radial.toFixed(0)} mmHg) is significantly lower than the femoral/ECMO PaO2 (${patientData_DH.po2_systemic.toFixed(0)} mmHg), confirming &lt;b&gt;Differential Hypoxia (Harlequin Syndrome)&lt;/b&gt;. This indicates substantial native LV ejection of poorly oxygenated blood from the failing lungs, perfusing the upper body.&lt;/p&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if(patientData_DH.vavEcmoActive) { interpretation = `&lt;p class='mt-3 text-sm font-semibold'&gt;Interpretation (Post-VAV ECMO):&lt;/p&gt;&lt;p class='text-xs'&gt;VAV ECMO is active. The PaO2 in the right radial artery (${patientData_DH.po2_r_radial.toFixed(0)} mmHg) should now be similar to or higher than the femoral/ECMO PaO2 (${patientData_DH.po2_systemic.toFixed(0)} mmHg), indicating resolution of differential hypoxia.&lt;/p&gt;`;}</p>
<p class="p1"><span class="Apple-converted-space">                </span>showLabResults_DH(title, results, interpretation); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'echo_cardiac_lv_recovery': title = "Focused Echocardiogram Report"; findings = `ECHO (${patientData_DH.scenarioTime.toFixed(0)} min):\nLV Function: LVEF ${(patientData_DH.nativeLVEF*100).toFixed(0)}%. Ongoing recovery. AoV Opening Factor: ${patientData_DH.aorticValveOpeningFactor.toFixed(2)}.\nRV Function: Moderately dilated/reduced. No gross shunt. IVC: ${patientData_DH.cvp &gt; 15 ? "Dilated" : (patientData_DH.cvp &lt; 8 ? "Small" : "Normal")}.\nImpression: Recovering LV, significant AoV opening. Consistent with potential for differential hypoxia.`; showInfoModal_DH(title, findings); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'cxr_ards': title = "Chest X-Ray Report"; findings = `CXR (${patientData_DH.scenarioTime.toFixed(0)} min):\nLungs: Diffuse bilateral opacities, consistent with severe ARDS. Lines in situ.\nImpression: Severe ARDS.`; showInfoModal_DH(title, findings); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'prePostGases_ecmo': results = { "PreOxyPaO2": `${patientData_DH.preMembranePaO2.toFixed(0)}`, "PreOxyPaCO2": `${patientData_DH.preMembranePaCO2.toFixed(0)}`, "PostOxyPaO2": `${patientData_DH.postMembranePaO2.toFixed(0)}`, "PostOxyPaCO2": `${patientData_DH.postMembranePaCO2.toFixed(0)}`}; showLabResults_DH("ECMO Pre/Post Membrane Gases", results, "&lt;p class='mt-3 text-xs'&gt;Oxygenator functioning well.&lt;/p&gt;"); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'lactate_serial': results = {"Lactate": `${patientData_DH.lactate.toFixed(1)} mmol/L`}; showLabResults_DH("Serial Lactate", results); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'ecg_12lead_general': title = "12-Lead ECG"; findings = `ECG: Sinus tachycardia ${patientData_DH.hr.toFixed(0)} bpm. No acute ischemic changes.`; showInfoModal_DH(title, findings); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'electrolytes_full': title = "Electrolytes"; results = { "K+": `${patientData_DH.potassium.toFixed(1)}`, "Mg++": `${patientData_DH.magnesium.toFixed(1)}`, "Ca++": `${patientData_DH.calcium.toFixed(1)}`, "Phos": `${patientData_DH.phosphate.toFixed(1)}`, "Na+": `${patientData_DH.sodium.toFixed(0)}`}; showLabResults_DH(title, results); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>case 'cbc_coags_full': results = { Hb: `${patientData_DH.cbcHb.toFixed(1)}`, Plt: `${patientData_DH.cbcPlt.toFixed(0)}`, INR: patientData_DH.coagINR.toFixed(1), aPTT: `${patientData_DH.coagAPTT.toFixed(0)}`}; showLabResults_DH("CBC &amp; Coags", results); break;</p>
<p class="p1"><span class="Apple-converted-space">            </span>default: logMessage_DH("Invalid diagnostic.", "warning"); return;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>logAction_DH(`Requested: ${diagnosticFriendlyName}`, "intervention");<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('diagnosticSelectedText').textContent = "Select Diagnostic..."; document.getElementById('diagnosticSelectedValue').value = "";</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Displays lab results in the info modal</p>
<p class="p1"><span class="Apple-converted-space">    </span>function showLabResults_DH(title, results, interpretation = "") {</p>
<p class="p1"><span class="Apple-converted-space">        </span>let body = `&lt;table class='w-full text-sm'&gt;&lt;thead&gt;&lt;tr class='bg-gray-100'&gt;&lt;th class='p-2 text-left'&gt;Parameter&lt;/th&gt;&lt;th class='p-2 text-left'&gt;Value&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>for (const key in results) { body += `&lt;tr&gt;&lt;td class='p-2 border-b'&gt;${key.startsWith('&lt;b&gt;') ? key : '&amp;nbsp;&amp;nbsp;' + key}&lt;/td&gt;&lt;td class='p-2 border-b font-medium'&gt;${results[key]}&lt;/td&gt;&lt;/tr&gt;`; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>body += "&lt;/tbody&gt;&lt;/table&gt;"; if (interpretation) body += interpretation;</p>
<p class="p1"><span class="Apple-converted-space">        </span>showInfoModal_DH(title, body);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Sets up custom dropdown menus</p>
<p class="p1"><span class="Apple-converted-space">    </span>function setupDropdown_DH(buttonId, optionsId, selectedTextId, selectedValueInputId, actionType) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const button = document.getElementById(buttonId); const optionsDiv = document.getElementById(optionsId); const arrowIcon = button.querySelector('.arrow-icon');</p>
<p class="p1"><span class="Apple-converted-space">        </span>button.addEventListener('click', (event) =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>event.stopPropagation();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (button.disabled) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const isOpen = optionsDiv.classList.toggle('open'); button.classList.toggle('open', isOpen); button.setAttribute('aria-expanded', isOpen); if(arrowIcon) arrowIcon.classList.toggle('rotated', isOpen);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>optionsDiv.addEventListener('click', (event) =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (event.target.tagName === 'A') {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>event.preventDefault(); const value = event.target.dataset.value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (actionType === 'intervention') { performIntervention_DH(value); } else if (actionType === 'diagnostic') { submitDiagnostic_DH(value); }</p>
<p class="p1"><span class="Apple-converted-space">                </span>optionsDiv.classList.remove('open'); button.classList.remove('open'); button.setAttribute('aria-expanded', 'false'); if(arrowIcon) arrowIcon.classList.remove('rotated');<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>}<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Closes dropdowns if clicked outside</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.addEventListener('click', (event) =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>['interventionOptions', 'diagnosticOptions'].forEach(id =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const options = document.getElementById(id); const btnId = id.replace('Options', 'DropdownButton'); const button = document.getElementById(btnId); const arrowIcon = button ? button.querySelector('.arrow-icon') : null;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (options &amp;&amp; options.classList.contains('open') &amp;&amp; button &amp;&amp; !button.contains(event.target) &amp;&amp; !options.contains(event.target)) { options.classList.remove('open'); button.classList.remove('open'); button.setAttribute('aria-expanded', 'false'); if(arrowIcon) arrowIcon.classList.remove('rotated');}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Handles "Next Scenario Event" button click</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById('nextEventButton').addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (document.getElementById('nextEventButton').disabled) return;</p>
<p class="p1"><span class="Apple-converted-space">        </span>patientData_DH.scenarioEventTriggers++;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>logAction_DH(`Advanced to Scenario Event ${patientData_DH.scenarioEventTriggers}`, "event");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (patientData_DH.scenarioEventTriggers === 1) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.nativeLVEF = 0.60;</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.aorticValveOpeningFactor = Math.min(1.0, patientData_DH.aorticValveOpeningFactor + 0.05);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.nativeLungOxygenationCapacity = 0.01;</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.awaitingVentOptimization = true;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>logMessage_DH("EVENT 1: LV function significantly improved (LVEF to 0.60). Native lung capacity critically worsened (to 0.01). Awaiting ventilator optimization.", "critical");</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (patientData_DH.scenarioEventTriggers === 2) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.lactate += 0.5;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>logMessage_DH("EVENT 2: Lactate trending up slightly. Continue close monitoring of perfusion and oxygenation.", "critical");</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (patientData_DH.scenarioEventTriggers &gt; 2) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>logMessage_DH("Further events: Differential hypoxia may be refractory if not managed. Consider advanced strategies.", "critical");<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateTrainerControlDisplays_DH(); // Update trainer controls to reflect event changes</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('vitalsMonitor').scrollIntoView({ behavior: 'smooth', block: 'start' });</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Event listeners for medication sliders</p>
<p class="p1"><span class="Apple-converted-space">    </span>['sedationSlider', 'paralyticSlider', 'inotropeSlider'].forEach(id =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById(id).addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (e.target.disabled) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const val = parseFloat(e.target.value); let actionDetail = "", previousValue; const targetValueSpanId = id.replace('Slider', 'Value'); const targetValueSpan = document.getElementById(targetValueSpanId);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (id === 'sedationSlider') { previousValue = patientData_DH.sedationLevel; patientData_DH.sedationLevel = val; actionDetail = `Sedation from ${previousValue.toFixed(0)} to ${val.toFixed(0)}`; targetValueSpan.textContent = val.toFixed(0);}</p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (id === 'paralyticSlider') { previousValue = patientData_DH.paralyticLevel; patientData_DH.paralyticLevel = val; actionDetail = `Paralytic from ${previousValue.toFixed(1)} to ${val.toFixed(1)}`; targetValueSpan.textContent = val.toFixed(1);}</p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (id === 'inotropeSlider') { previousValue = patientData_DH.inotropeLevel; patientData_DH.inotropeLevel = val; actionDetail = `Inotrope from ${previousValue.toFixed(0)} to ${val.toFixed(0)}`; targetValueSpan.textContent = val.toFixed(0);}</p>
<p class="p1"><span class="Apple-converted-space">            </span>logAction_DH(`Adjusted ${actionDetail}`);</p>
<p class="p1"><span class="Apple-converted-space">            </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Trainer Controls Setup</p>
<p class="p1"><span class="Apple-converted-space">    </span>const trainerControlsHeader_DH = document.getElementById('trainerControlsHeader');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const trainerControlsContent_DH = document.getElementById('trainerControlsContent');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const trainerControlsToggleIcon_DH = document.getElementById('trainerControlsToggleIcon');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (trainerControlsHeader_DH &amp;&amp; trainerControlsContent_DH &amp;&amp; trainerControlsToggleIcon_DH) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>trainerControlsHeader_DH.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (trainerControlsHeader_DH.disabled) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const isExpanded = trainerControlsContent_DH.classList.toggle('expanded');</p>
<p class="p1"><span class="Apple-converted-space">            </span>trainerControlsHeader_DH.setAttribute('aria-expanded', isExpanded);</p>
<p class="p1"><span class="Apple-converted-space">            </span>trainerControlsToggleIcon_DH.classList.toggle('rotated', isExpanded);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function setupTrainerControls_DH() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lungCapacitySlider = document.getElementById('trainerLungCapacitySlider');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lungCapacityValue = document.getElementById('trainerLungCapacityValue');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lvefSlider = document.getElementById('trainerLvefSlider');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lvefValue = document.getElementById('trainerLvefValue');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const aovFactorSlider = document.getElementById('trainerAovFactorSlider');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const aovFactorValue = document.getElementById('trainerAovFactorValue');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const cvpInput = document.getElementById('trainerCvpInput');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const cvpValue = document.getElementById('trainerCvpValue');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lactateInput = document.getElementById('trainerLactateInput');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lactateValue = document.getElementById('trainerLactateValue');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const inhaledNoToggle = document.getElementById('trainerInhaledNoToggle');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const vavEcmoToggle = document.getElementById('trainerVavEcmoToggle');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Initialize display values</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateTrainerControlDisplays_DH();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>lungCapacitySlider.addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const val = parseFloat(e.target.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.nativeLungOxygenationCapacity = val;</p>
<p class="p1"><span class="Apple-converted-space">            </span>lungCapacityValue.textContent = val.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">            </span>logAction_DH(`Trainer: Set Native Lung O2 Capacity to ${val.toFixed(2)}.`, 'trainer');</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (val &gt; 0.01) patientData_DH.awaitingVentOptimization = false; // If trainer fixes it, no longer waiting.</p>
<p class="p1"><span class="Apple-converted-space">            </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>lvefSlider.addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const val = parseFloat(e.target.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.nativeLVEF = val;</p>
<p class="p1"><span class="Apple-converted-space">            </span>lvefValue.textContent = val.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">            </span>logAction_DH(`Trainer: Set Native LVEF to ${val.toFixed(2)}.`, 'trainer');</p>
<p class="p1"><span class="Apple-converted-space">            </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>aovFactorSlider.addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const val = parseFloat(e.target.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.aorticValveOpeningFactor = val;</p>
<p class="p1"><span class="Apple-converted-space">            </span>aovFactorValue.textContent = val.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">            </span>logAction_DH(`Trainer: Set AoV Opening Factor to ${val.toFixed(2)}.`, 'trainer');</p>
<p class="p1"><span class="Apple-converted-space">            </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>cvpInput.addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const val = parseFloat(e.target.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.cvp = val;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cvpValue.textContent = val.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">            </span>logAction_DH(`Trainer: Override CVP to ${val.toFixed(0)} mmHg.`, 'trainer');</p>
<p class="p1"><span class="Apple-converted-space">            </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>lactateInput.addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const val = parseFloat(e.target.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.lactate = val;</p>
<p class="p1"><span class="Apple-converted-space">            </span>lactateValue.textContent = val.toFixed(1);</p>
<p class="p1"><span class="Apple-converted-space">            </span>logAction_DH(`Trainer: Override Lactate to ${val.toFixed(1)} mmol/L.`, 'trainer');</p>
<p class="p1"><span class="Apple-converted-space">            </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>inhaledNoToggle.addEventListener('change', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.inhaledNOPulmonaryVasodilatorActive = e.target.checked;</p>
<p class="p1"><span class="Apple-converted-space">            </span>logAction_DH(`Trainer: Set Inhaled NO Active to ${e.target.checked}.`, 'trainer');</p>
<p class="p1"><span class="Apple-converted-space">            </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>vavEcmoToggle.addEventListener('change', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>patientData_DH.vavEcmoActive = e.target.checked;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (patientData_DH.vavEcmoActive) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.differentialHypoxiaActive = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>patientData_DH.awaitingVentOptimization = false; // VAV ECMO often implies scenario shift</p>
<p class="p1"><span class="Apple-converted-space">                </span>logAction_DH("Trainer: Manually activated VAV ECMO.", "trainer");</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>logAction_DH("Trainer: Manually deactivated VAV ECMO. Differential hypoxia may re-occur based on physiology.", "trainer");</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Recalculation will determine if differentialHypoxiaActive should be true</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>triggerFullUpdate_DH();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Updates trainer control UI elements to reflect current patientData_DH</p>
<p class="p1"><span class="Apple-converted-space">    </span>function updateTrainerControlDisplays_DH() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerLungCapacitySlider').value = patientData_DH.nativeLungOxygenationCapacity.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerLungCapacityValue').textContent = patientData_DH.nativeLungOxygenationCapacity.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerLvefSlider').value = patientData_DH.nativeLVEF.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerLvefValue').textContent = patientData_DH.nativeLVEF.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerAovFactorSlider').value = patientData_DH.aorticValveOpeningFactor.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerAovFactorValue').textContent = patientData_DH.aorticValveOpeningFactor.toFixed(2);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerCvpInput').value = patientData_DH.cvp.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerCvpValue').textContent = patientData_DH.cvp.toFixed(0);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerLactateInput').value = patientData_DH.lactate.toFixed(1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerLactateValue').textContent = patientData_DH.lactate.toFixed(1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerInhaledNoToggle').checked = patientData_DH.inhaledNOPulmonaryVasodilatorActive;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('trainerVavEcmoToggle').checked = patientData_DH.vavEcmoActive;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Central function to trigger all necessary UI updates after a change</p>
<p class="p1"><span class="Apple-converted-space">    </span>function triggerFullUpdate_DH() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>calculateDerivedPhysiology_DH(); // This must be first</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateMonitorDisplays_DH(); <span class="Apple-converted-space">     </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>updateControlPanelDisplays_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>renderVentilatorParams_DH(); // Update vent params display if needed</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateTrainerControlDisplays_DH(); // Sync trainer controls if a parameter was changed by intervention/event</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Waveforms are updated by their own interval (fastUpdateIntervalId_DH) but recalculating physiology might change inputs</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Handles "Finish Scenario" button click</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById('finishScenarioButton').addEventListener('click', () =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>clearInterval(simIntervalId_DH); clearInterval(fastUpdateIntervalId_DH); logAction_DH("Scenario Finished.", "event");</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('nextEventButton').disabled = true; document.getElementById('finishScenarioButton').disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('interventionDropdownButton').disabled = true; document.getElementById('diagnosticDropdownButton').disabled = true;<span class="Apple-converted-space">   </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('postScenarioOptions').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Disable all interactive controls</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.querySelectorAll('.input-slider, .dial-btn, #ventModeSelector, #ventilatorSettingsHeader, #trainerControlsHeader, #trainerControlsContent input, #trainerControlsContent button').forEach(el =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>el.disabled = true;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if(el.classList.contains('cursor-pointer')) el.classList.remove('cursor-pointer');<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>// Handles "Debriefing" button click</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById('debriefingButton').addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>let debriefHtml = "&lt;h4 class='text-lg font-semibold mb-4 text-gray-800'&gt;Scenario Debrief: VA ECMO &amp; Differential Hypoxia (V2.0)&lt;/h4&gt;";</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>debriefHtml += "&lt;div class='mb-4 border border-gray-200 p-3 rounded-lg bg-sky-50'&gt;&lt;h5 class='text-base font-semibold text-sky-700 mb-2'&gt;Ideal Steps in Managing Differential Hypoxia:&lt;/h5&gt;&lt;ul class='list-disc pl-5 text-sm space-y-1.5 text-gray-700'&gt;";</p>
<p class="p1"><span class="Apple-converted-space">        </span>const idealSteps = [</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Recognize &amp; Confirm: High index of suspicion (recovering LV, poor lungs). Monitor R. arm SpO2 vs. lower limb/ECMO SpO2. Perform paired ABGs (R. Radial vs. Femoral/ECMO).",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Optimize Native Lung Oxygenation: Increase ventilator FiO2 to 100%. Optimize PEEP and overall ventilation strategy (lung protective, consider recruitment, APRV).",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Optimize ECMO Support: Ensure ECMO FiO2 is 100%. Increase ECMO flow to maximize oxygen delivery and potentially enhance proximal mixing.",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Improve V/Q Matching in Native Lungs: Consider inhaled pulmonary vasodilators (e.g., iNO).",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Address Hemodynamics &amp; Myocardial Oxygen Demand: Maintain adequate MAP. Cautiously consider beta-blockers if severe, refractory differential hypoxia (specialist decision).",</p>
<p class="p1"><span class="Apple-converted-space">            </span>"Escalate if Refractory: Consult ECMO specialist/cardiac surgery. Consider VAV ECMO or other hybrid cannulation strategies."</p>
<p class="p1"><span class="Apple-converted-space">        </span>];</p>
<p class="p1"><span class="Apple-converted-space">        </span>idealSteps.forEach(step =&gt; { debriefHtml += `&lt;li class='ideal-step'&gt;${step}&lt;/li&gt;`; });</p>
<p class="p1"><span class="Apple-converted-space">        </span>debriefHtml += "&lt;/ul&gt;&lt;/div&gt;";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>debriefHtml += "&lt;div class='border border-gray-200 p-3 rounded-lg bg-gray-50'&gt;&lt;h5 class='text-base font-semibold text-gray-700 mb-2'&gt;Analysis of Actions Taken (User &amp; Trainer):&lt;/h5&gt;&lt;ul class='list-disc pl-5 text-sm space-y-1'&gt;";</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const actions = patientData_DH.actionsTaken;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let pairedAbgDone = actions.some(a =&gt; a.action.toLowerCase().includes("paired abg"));</p>
<p class="p1"><span class="Apple-converted-space">        </span>let ventFio2Maxed = actions.some(a =&gt; a.action.toLowerCase().includes("ventilator fio2 to 100%"));</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!ventFio2Maxed &amp;&amp; patientData_DH.ventFiO2 === 100) ventFio2Maxed = true;<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let peepOptimized = actions.some(a =&gt; a.action.toLowerCase().includes("increase ventilator peep") &amp;&amp; ( (patientData_DH.ventMode === "PCV_AC" &amp;&amp; patientData_DH.ventPEEP_PCVAC &gt;= 14) || (patientData_DH.ventMode === "PRVC" &amp;&amp; patientData_DH.ventPEEP_PRVC &gt;= 14) || (patientData_DH.ventMode === "APRV" &amp;&amp; patientData_DH.ventPLow_APRV &gt;= 6) ));</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!peepOptimized &amp;&amp; ( (patientData_DH.ventMode === "PCV_AC" &amp;&amp; patientData_DH.ventPEEP_PCVAC &gt;= 14) || (patientData_DH.ventMode === "PRVC" &amp;&amp; patientData_DH.ventPEEP_PRVC &gt;= 14) || (patientData_DH.ventMode === "APRV" &amp;&amp; patientData_DH.ventPLow_APRV &gt;= 6) )) peepOptimized = true;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>let ecmoFlowIncreased = actions.some(a =&gt; a.action.toLowerCase().includes("increase ecmo flow") || a.action.toLowerCase().includes("increased ecmo rpm"));</p>
<p class="p1"><span class="Apple-converted-space">        </span>let vavInitiatedUser = actions.some(a =&gt; a.action.toLowerCase().includes("vav ecmo initiated") &amp;&amp; a.type !== 'trainer');</p>
<p class="p1"><span class="Apple-converted-space">        </span>let vavInitiatedTrainer = actions.some(a =&gt; a.action.toLowerCase().includes("trainer: manually activated vav ecmo"));</p>
<p class="p1"><span class="Apple-converted-space">        </span>let vavInitiated = vavInitiatedUser || vavInitiatedTrainer;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (pairedAbgDone) { debriefHtml += "&lt;li class='action-taken-good'&gt;&lt;i class='fas fa-check-circle mr-1'&gt;&lt;/i&gt;Paired ABGs performed - Crucial step taken.&lt;/li&gt;"; }<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>else { debriefHtml += "&lt;li class='action-taken-missed'&gt;&lt;i class='fas fa-times-circle mr-1'&gt;&lt;/i&gt;Paired ABGs not performed - Key diagnostic missed for confirmation and quantification.&lt;/li&gt;"; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (ventFio2Maxed) { debriefHtml += "&lt;li class='action-taken-good'&gt;&lt;i class='fas fa-check-circle mr-1'&gt;&lt;/i&gt;Ventilator FiO2 increased to 100% - Correct.&lt;/li&gt;"; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else { debriefHtml += `&lt;li class='action-taken-consider'&gt;&lt;i class='fas fa-exclamation-circle mr-1'&gt;&lt;/i&gt;Ventilator FiO2 was ${patientData_DH.ventFiO2}%. Consider increasing to 100%.&lt;/li&gt;`; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (peepOptimized) { debriefHtml += "&lt;li class='action-taken-good'&gt;&lt;i class='fas fa-check-circle mr-1'&gt;&lt;/i&gt;PEEP appears to have been optimized (based on set values &gt;= 14 or P-Low &gt;=6).&lt;/li&gt;"; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else { debriefHtml += "&lt;li class='action-taken-consider'&gt;&lt;i class='fas fa-exclamation-circle mr-1'&gt;&lt;/i&gt;PEEP optimization should be considered.&lt;/li&gt;"; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (actions.some(a =&gt; a.action.toLowerCase().includes("optimize ventilator strategy"))) { debriefHtml += "&lt;li class='action-taken-good'&gt;&lt;i class='fas fa-check-circle mr-1'&gt;&lt;/i&gt;'Optimize Ventilator Strategy' selected, implying broader consideration.&lt;/li&gt;"; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (patientData_DH.ecmoFiO2 &lt; 100) { debriefHtml += `&lt;li class='action-taken-missed'&gt;&lt;i class='fas fa-times-circle mr-1'&gt;&lt;/i&gt;ECMO FiO2 was ${patientData_DH.ecmoFiO2}%. Should be 100%.&lt;/li&gt;`; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else { debriefHtml += "&lt;li class='action-taken-good'&gt;&lt;i class='fas fa-check-circle mr-1'&gt;&lt;/i&gt;ECMO FiO2 maintained at 100% - Correct.&lt;/li&gt;"; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (ecmoFlowIncreased) { debriefHtml += "&lt;li class='action-taken-good'&gt;&lt;i class='fas fa-check-circle mr-1'&gt;&lt;/i&gt;ECMO flow was increased - Potentially beneficial.&lt;/li&gt;"; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else { debriefHtml += "&lt;li class='action-taken-consider'&gt;&lt;i class='fas fa-exclamation-circle mr-1'&gt;&lt;/i&gt;Increasing ECMO flow could be considered to improve total O2 delivery.&lt;/li&gt;"; }</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>let inhaledNoUser = actions.some(a =&gt; a.action.toLowerCase().includes("pulmonary vasodilator") &amp;&amp; a.type !== 'trainer');</p>
<p class="p1"><span class="Apple-converted-space">        </span>let inhaledNoTrainer = actions.some(a =&gt; a.action.toLowerCase().includes("trainer: set inhaled no active to true"));</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (inhaledNoUser || inhaledNoTrainer) { debriefHtml += "&lt;li class='action-taken-good'&gt;&lt;i class='fas fa-check-circle mr-1'&gt;&lt;/i&gt;Inhaled pulmonary vasodilator administered/activated.&lt;/li&gt;"; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else { debriefHtml += "&lt;li class='action-taken-consider'&gt;&lt;i class='fas fa-exclamation-circle mr-1'&gt;&lt;/i&gt;Consider inhaled pulmonary vasodilator if appropriate.&lt;/li&gt;"; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (vavInitiated) { debriefHtml += `&lt;li class='action-taken-good font-bold'&gt;&lt;i class='fas fa-star mr-1'&gt;&lt;/i&gt;VAV ECMO was initiated${vavInitiatedTrainer ? " by trainer" : ""} - Definitive management.&lt;/li&gt;`; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>else if (patientData_DH.spO2_r_arm &lt; 85 &amp;&amp; patientData_DH.scenarioEventTriggers &gt;=1 &amp;&amp; !patientData_DH.vavEcmoActive) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">             </span>debriefHtml += "&lt;li class='action-taken-missed'&gt;&lt;i class='fas fa-times-circle mr-1'&gt;&lt;/i&gt;Differential hypoxia persists/severe. Consider escalating to VAV ECMO.&lt;/li&gt;";</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (actions.some(a =&gt; a.action.toLowerCase().includes("consult cardiac surgery"))) { debriefHtml += "&lt;li class='action-taken-good'&gt;&lt;i class='fas fa-check-circle mr-1'&gt;&lt;/i&gt;Specialist consultation sought.&lt;/li&gt;"; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (patientData_DH.vavEcmoActive || (!patientData_DH.differentialHypoxiaActive &amp;&amp; patientData_DH.spO2_r_arm &gt;=90) ) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>debriefHtml += "&lt;li class='action-taken-good font-semibold mt-2'&gt;Outcome: Differential hypoxia appears resolved or effectively managed.&lt;/li&gt;";</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else if (patientData_DH.spO2_r_arm &lt; 88) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>debriefHtml += `&lt;li class='action-taken-missed font-semibold mt-2'&gt;Outcome: Significant upper body hypoxemia (R.Arm SpO2: ${patientData_DH.spO2_r_arm.toFixed(0)}%) persists. Further aggressive management needed.&lt;/li&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">             </span>debriefHtml += `&lt;li class='action-taken-consider font-semibold mt-2'&gt;Outcome: Upper body oxygenation (R.Arm SpO2: ${patientData_DH.spO2_r_arm.toFixed(0)}%) requires ongoing attention.&lt;/li&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>debriefHtml += "&lt;/ul&gt;&lt;/div&gt;";</p>
<p class="p1"><span class="Apple-converted-space">        </span>debriefHtml += "&lt;div class='mt-2 text-xs text-gray-600'&gt;Note: Green indicates actions aligned with ideal steps. Orange indicates areas for consideration or missed opportunities. Red indicates critical missed steps.&lt;/div&gt;";</p>
<p class="p1"><span class="Apple-converted-space">        </span>showInfoModal_DH("Scenario Debriefing (V2.0)", debriefHtml);</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Initial setup on window load</p>
<p class="p1"><span class="Apple-converted-space">    </span>window.onload = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>displayInitialHistory_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('sedationSlider').value = patientData_DH.sedationLevel;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('paralyticSlider').value = patientData_DH.paralyticLevel;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('inotropeSlider').value = patientData_DH.inotropeLevel;</p>
<p class="p1"><span class="Apple-converted-space">        </span>setupDropdown_DH('interventionDropdownButton', 'interventionOptions', 'interventionSelectedText', 'interventionSelectedValue', 'intervention');</p>
<p class="p1"><span class="Apple-converted-space">        </span>setupDropdown_DH('diagnosticDropdownButton', 'diagnosticOptions', 'diagnosticSelectedText', 'diagnosticSelectedValue', 'diagnostic');</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateDial_DH('rpm', patientData_DH.ecmoRpm, dialSettings_DH.rpm.min, dialSettings_DH.rpm.max);</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateDial_DH('sweep', patientData_DH.ecmoSweep, dialSettings_DH.sweep.min, dialSettings_DH.sweep.max);</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateDial_DH('fio2', patientData_DH.ecmoFiO2, dialSettings_DH.fio2.min, dialSettings_DH.fio2.max);</p>
<p class="p1"><span class="Apple-converted-space">        </span>ventModeSelector_DH.value = patientData_DH.ventMode;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>setupTrainerControls_DH(); // Initialize trainer controls</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>initAllWaveforms_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>initVentilatorWaveform_DH();<span class="Apple-converted-space"> </span></p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>triggerFullUpdate_DH(); // Initial full update</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>simIntervalId_DH = setInterval(advanceScenarioState_DH, simulationInterval_DH);</p>
<p class="p1"><span class="Apple-converted-space">        </span>fastUpdateIntervalId_DH = setInterval(() =&gt; {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateMonitorDisplays_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateControlPanelDisplays_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateVentilatorWaveform_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateEcgWaveform_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateArterialLineChart_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateSpo2PlethWaveform_DH();<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Trainer displays are updated on input or by triggerFullUpdate, not necessarily every fast tick.</p>
<p class="p1"><span class="Apple-converted-space">        </span>}, fastUpdateInterval_DH);</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
